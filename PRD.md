# 鄰里市集 - 產品需求文件
**Product Requirements Document**

**產品名稱:** 鄰里市集 (Neighbor Marketplace)
**專案代號:** BMAD2
**作者:** Product Team
**日期:** 2025-11-13
**版本:** 2.2（需求完整性補充）

---

## 執行摘要

### 產品願景

**鄰里市集**是一個專為台灣住宅社區設計的二手交易平台，讓鄰居之間能夠安全、便利地交易閒置物品。不同於傳統的二手交易平台，我們專注於**超在地化**的交易體驗——所有交易都發生在同一社區或步行可達的鄰近社區內。

**核心價值主張:**
- 🏘️ **超在地**: 只與鄰居交易，步行即可取貨
- 🤝 **信任感**: 社區認證機制，交易更安心
- ⚡ **零運費**: 不需郵寄，當面交易最快速
- 🌱 **永續環保**: 延長物品生命週期，減少浪費
- 💚 **社區凝聚**: 透過交易認識鄰居，增進社區感情

### 產品的獨特魅力

**這個產品最特別的地方在於「信任圈」概念** — 我們創造一個只有鄰居才能參與的交易空間。當你知道賣家就住在隔壁棟、買家明天會在社區中庭碰面時，整個交易氛圍完全不同。這不只是買賣，更是建立社區關係的契機。

**那個讓人驚艷的瞬間:**
當使用者第一次打開App，看到「你的社區裡有15件新物品上架」，點進去發現是三樓王太太的嬰兒床、一樓李先生的腳踏車、隔壁棟正在出清的書櫃——這種「就在身邊」的真實感，是其他平台無法提供的魔力。

---

## 專案分類

**技術類型:** 行動應用程式 (Mobile App - Flutter)
**平台支援:** iOS 與 Android 雙平台
**領域:** 社區電商 / 在地市集 / C2C交易
**複雜度:** 中等

### 專案特性

這是一個**社區型電商平台**，結合了：
- **地理位置服務** (Location-based Services)
- **社群功能** (Community Features)
- **公開留言機制** (Public Comment Board)
- **信任與安全機制** (Trust & Safety)
- **內容審核** (Content Moderation)

### 台灣在地化考量

- **語言**: 繁體中文為主要介面語言
- **支付習慣**: 以現金交易為主，未來支援LINE Pay、街口支付
- **社區文化**: 台灣公寓大樓普遍有管理委員會，可作為驗證管道
- **使用者特性**: 需考慮中高齡使用者（銀髮族友善設計）
- **隱私考量**: 台灣使用者重視個人隱私，避免過度曝光個人資訊

---

## 成功標準

### 產品成功指標

**MVP階段成功定義：**

1. **社區滲透率**
   - 目標：3個月內在10個社區達到10%住戶註冊率
   - 意義：當社區內有足夠用戶，交易頻率才能提升

2. **交易完成率**
   - 目標：從商品上架到交易完成的轉換率達到25%
   - 意義：證明平台確實解決了在地交易需求

3. **使用者留存**
   - 目標：月留存率 > 40%
   - 意義：使用者願意持續回來瀏覽和交易

4. **社區活躍度**
   - 目標：平均每個社區每週新增5件商品
   - 意義：有穩定的商品供給才能吸引買家

5. **信任指標**
   - 目標：80%的交易都有完成評價
   - 意義：使用者願意完成評價代表交易體驗良好

**質化成功指標：**

- 使用者反饋「比其他平台更安心」
- 社區內開始有口碑傳播（鄰居推薦鄰居）
- 使用者主動分享成功交易的故事
- 長輩使用者能順利完成交易流程

### 業務指標（未來考量）

- 用戶獲取成本 (CAC) < NT$50
- 月活躍用戶 (MAU) 成長率 > 20%
- 單一社區平均GMV達到 NT$10,000/月

---

## 產品範圍

### MVP - 最小可行產品（Phase 1）

**核心目標**: 驗證「社區內交易」的需求與可行性，提供最基本但完整的交易流程。

**必備功能：**

#### 1. 使用者管理
- ✅ 第三方登入（Google、Apple、LINE）
- ✅ 社區身份驗證（QR Code掃描 + 門牌綁定）
- ✅ 基本個人資料設定（暱稱、頭像、Email）
- ✅ 個人主頁（評分、交易次數、商品列表、收到的評價）
- ✅ 社區資訊顯示（我的社區、門牌號碼）

#### 2. 商品管理（簡化版）
- ✅ 快速發布商品（固定4張照片、標題、摘要）
- ✅ 商品狀態選擇（全新 / 二手）
- ✅ 使用時間區間選擇（6個選項）
- ✅ 商品網址連結（選填，自動抓取標題）
- ✅ 價格設定（固定價格 / 可議價 / 免費贈送）
- ✅ 商品分類（自動判斷或手動選擇）
- ✅ 商品狀態管理（上架中、已預訂、已售出、已下架）
- ✅ 我的商品列表（編輯、刪除、重新上架）

#### 3. 探索與搜尋
- ✅ 首頁動態（我的社區新上架商品）
- ✅ 附近社區切換（切換到鄰近社區瀏覽）
- ✅ 分類瀏覽
- ✅ 關鍵字搜尋
- ✅ 商品詳情頁面

#### 4. 交易溝通（留言板系統）
- ✅ 商品留言板（公開 + 隱私留言）
- ✅ 發布留言（文字，可選擇公開或僅賣家可見）
- ✅ 賣家回覆留言
- ✅ 快速留言範本（6種常用語句）
- ✅ 一鍵議價功能（💰 議價按鈕、自動計算折扣、賣家快速回覆）
- ✅ 留言推播通知（賣家收到留言、買家收到回覆）
- ✅ 我的留言管理
- ✅ 隱私留言權限控制

#### 5. 彈性交易模式與現金支付
- ✅ 管理室代收服務（代收編號、6位數取貨碼）
- ✅ 社區公共區域面交（大廳、中庭、郵件室）
- ✅ 門口/樓下面交（約定地點）
- ✅ 面交地點建議與安全提示
- ✅ 現金支付機制（管理室代為收款與轉交）

#### 6. 交易確認與評價
- ✅ 交易完成確認（買賣雙方確認）
- ✅ 評價系統（5星評分 + 文字評價）
- ✅ 個人信用分數顯示
- ✅ 交易紀錄查詢

#### 7. 安全與信任
- ✅ 檢舉機制（檢舉不當商品/留言/用戶）
- ✅ 封鎖用戶功能
- ✅ 社區認證徽章顯示
- ✅ QR Code社區驗證（管理員後台）

#### 8. 推播通知系統（MVP即包含）
- ✅ 留言推播（收到新留言、收到賣家回覆）
- ✅ 交易確認通知
- ✅ 評價提醒通知
- ✅ 通知設定（可關閉特定類型通知）
- ✅ 夜間靜音模式（23:00-08:00）
- ✅ 通知分組與合併

#### 9. 管理員後台（Web）
- ✅ 管理員登入系統
- ✅ 社區管理（新增/編輯社區資訊）
- ✅ 住戶地址管理（建築、樓層、門牌）
- ✅ QR Code產生器（為特定門牌產生驗證QR Code）
- ✅ 已驗證住戶列表查詢
- ✅ 驗證記錄查看（時間、IP位址）
- ✅ 管理室代收商品管理（代收清單、現金管理）

**MVP不包含的功能（明確排除）：**
- ❌ 物流/運送功能（僅支援面交）
- ❌ 線上支付（MVP階段僅現金交易）
- ❌ 社群公告欄
- ❌ 團購功能
- ❌ 進階搜尋過濾
- ❌ 商品收藏/追蹤
- ❌ 商品分享功能

---

### 成長功能（Phase 2 - Post-MVP）

**目標**: 提升使用者體驗與參與度，增加黏著性

**核心新功能（Nice-to-have）:**

1. **批量上架功能** 📦
   - 一次選擇多個商品照片（支援10-20件商品）
   - 快速複製上一個商品的資訊作為範本
   - 批次設定共同屬性（例：同一類別、同樣的二手狀態）
   - 批次價格設定（例：全部打8折）
   - 預覽待上架清單，一次發布
   - 適用場景：搬家大出清、整理衣櫃、換季商品
   - **產品魔力**: 讓大掃除變得輕鬆！阿姨一次整理出20件東西，不用一件一件慢慢發布。

2. **社區公告整合** 📢
   - 社區公告欄（管理委員會發布）
   - 社區活動通知（中秋烤肉、年終大掃除）
   - 失物招領專區（撿到鑰匙、寵物走失）
   - 需求牆（徵求特定物品、尋找拼車、揪團購）
   - 管理員後台可發布公告（權限控制）
   - 公告置頂於首頁
   - 推播重要公告給所有社區成員
   - **產品魔力**: 不只是交易平台，更是社區的數位布告欄。所有鄰居的需求都在這裡流動。

3. **以物易物功能** 🔄
   - 商品發布時可選擇「交換」模式
   - 填寫想交換的物品類型（例：「我的電風扇換你的除濕機」）
   - 買家可提議交換方案（例：「我有除濕機，願意跟你換」）
   - 交換提議包含照片與描述
   - 賣家可接受/拒絕/提出反提議
   - 交換模式支援「商品+差價」組合
   - 交換完成後雙方互評
   - **產品魔力**: 真正的鄰里互助！不用錢也能換到需要的東西，延續物品價值的同時增進鄰里情誼。

**其他優化功能:**

4. **強化探索功能**
   - 進階篩選（價格區間、商品狀態、距離）
   - 商品收藏/願望清單
   - 儲存搜尋條件
   - 新品上架通知

5. **交易增強**
   - 面交時間預約系統
   - 交易提醒通知
   - 線上支付整合（LINE Pay、街口支付）

6. **用戶體驗優化**
   - 語音訊息（方便長輩使用）
   - 照片編輯工具（濾鏡、裁切、標注）
   - 商品範本（快速重複上架相似商品）

---

### 願景功能（Phase 3 - Future）

**目標**: 打造完整的社區生活平台

**夢想功能（Dream Features）:**

1. **AI智能拍照輔助** 🤖📸
   - **自動背景移除**: 一鍵去除雜亂背景，讓商品成為焦點
   - **智能光線調整**: 自動增強照片亮度、對比度、色彩飽和度
   - **智能裁切與構圖**: AI自動偵測商品主體，建議最佳裁切範圍
   - **拍攝角度建議**: 即時顯示「建議拍攝正面」「建議加拍側面」等提示
   - **照片品質評分**: 即時評分（1-5星），建議重拍或調整
   - **一鍵美化**: 綜合套用所有AI優化（自動去背、調光、裁切）
   - **瑕疵標註輔助**: AI自動偵測並建議標註刮痕、污漬等瑕疵位置
   - **商品識別與標題建議**: AI辨識商品類型，自動建議標題與描述
   - **相似商品價格參考**: 掃描商品後顯示社區內相似商品的價格範圍
   - **適用場景**:
     - 長輩不會拍照？AI幫你拍得像專業賣家
     - 光線不好？AI自動調亮
     - 背景雜亂？AI一鍵去背
   - **產品魔力**: 讓每個人都能拍出專業級商品照！即使是第一次賣東西的阿姨，AI也能讓她的照片看起來跟專業賣家一樣吸引人。

**其他願景功能:**

2. **社區團購**
   - 揪團購買（水果、日用品）
   - 團購進度追蹤
   - 團主管理功能

3. **社區生活服務**
   - 社區二手市集活動組織
   - 社區捐贈箱媒合
   - 鄰里互助（借用工具、技能交換）

4. **進階AI智慧功能**
   - 智能定價建議（基於歷史交易數據）
   - 商品推薦算法（個人化推薦）
   - 自動分類與標籤（商品自動歸類）

5. **跨社區生態**
   - 跨社區聯盟（附近社區共享商品池）
   - 區域性活動（跨社區二手市集）
   - 物業管理系統整合

6. **環保激勵機制**
   - 交易累積碳足跡減量計算
   - 環保勳章系統（交易里程碑）
   - 與環保團體合作回收通道

---

## 行動應用程式特定需求

### 平台支援

**iOS:**
- 最低支援版本: iOS 14.0+
- 目標裝置: iPhone 8 及以上機型
- 必須通過 App Store 審核標準

**Android:**
- 最低支援版本: Android 8.0 (API 26)+
- 目標裝置: 主流品牌（Samsung, ASUS, OPPO, etc.）
- 發布於 Google Play Store

**技術架構:**
- 使用 Flutter 框架實現跨平台開發
- 單一程式碼庫，原生效能
- 支援 Material Design 與 iOS Human Interface Guidelines

### 裝置功能需求

**必要權限：**
1. **相機** - 拍攝商品照片
2. **相簿** - 選擇現有照片
3. **網路** - 資料傳輸
4. **推播通知** - 訊息通知（Phase 2）
5. **位置服務** - 社區定位與距離計算（可選，用於社區驗證）

**儲存需求：**
- App 大小: < 50MB
- 本地快取: < 100MB
- 支援離線瀏覽已載入內容

**效能需求：**
- 冷啟動時間 < 3秒
- 頁面切換流暢（60fps）
- 圖片載入優化（漸進式載入、快取機制）

### 應用商店合規

**必須遵守:**
- Apple App Store Review Guidelines
- Google Play 開發者政策
- 兒童隱私保護（避免13歲以下用戶）
- 內容審核機制（禁止違法商品）

---

## 使用者體驗原則

### 設計理念

**核心原則:**

1. **親切溫暖 (Warmth)**
   這是鄰居之間的交易，不是冰冷的電商。介面應該傳遞社區的溫度。
   - 使用溫暖色調（橘色、淺綠色）
   - 友善的插圖與圖示
   - 人性化的文案（「你的鄰居剛上架了...」）

2. **簡單明瞭 (Clarity)**
   任何年齡層都能輕鬆使用。
   - 大按鈕、清晰標籤
   - 扁平化資訊架構（3層以內）
   - 避免過多選項造成困惑

3. **快速高效 (Efficiency)**
   發布商品、溝通、完成交易都要極度流暢。
   - 發布商品 < 2分鐘
   - 快速回覆功能
   - 最少點擊次數達成目標

4. **銀髮友善 (Senior-Friendly)**
   考慮中高齡使用者的需求。
   - 可調整字體大小
   - 高對比度選項
   - 語音輸入支援（Phase 2）
   - 簡化的操作流程

5. **在地文化 (Localization)**
   深度適應台灣使用習慣。
   - 注音輸入法支援
   - 台灣常見商品分類
   - 台灣用語（「面交」「議價」「全新」）
   - 避開數字4相關的UI元素編號

### 關鍵互動流程

#### 1. 首次使用 (Onboarding)
```
下載App → 選擇第三方登入（Google/Apple/LINE）→
完成登入 → 前往社區管理室 →
管理員產生QR Code → 掃描QR Code →
確認社區與門牌資訊 → 綁定成功 →
「歡迎加入【XX社區】XX號」→ 瀏覽社區商品
```
**設計重點:**
- 登入介面清楚顯示三個第三方登入選項（大按鈕、品牌配色）
- 登入後引導使用者「前往管理室完成社區驗證」
- 提供管理室位置與開放時間資訊（若社區有提供）
- QR Code掃描介面簡單明瞭（相機畫面+掃描框）
- 綁定成功後立即顯示社區已有的商品數量與最新商品
- 可選擇「稍後驗證」（但無法發布商品和留言，僅能瀏覽）

#### 2. 發布商品 (Quick Listing - 簡化版)
```
點擊「發布」→ 拍攝/選擇4張照片（必須） →
選擇「全新」或「二手」→ 貼上商品網址（選填）→
系統自動抓取標題（或手動填寫）→ 填寫摘要 →
選擇使用時間區間 → 設定價格（可議價選項）→
確認發布（< 2分鐘完成）
```
**設計重點:**
- 固定4張照片（強制要求，建議拍攝角度）
- 全新/二手大按鈕選擇（圖示+文字）
- 商品網址輸入框有提示（例：「貼上momo、蝦皮等購物連結」）
- 自動抓取成功時顯示勾選動畫與商品標題預覽
- 使用時間區間用滑桿或選擇器呈現
- 價格輸入框智能鍵盤（純數字）
- 進度指示器（步驟1/7、2/7...）
- 可隨時儲存草稿，稍後繼續編輯

#### 3. 瀏覽與搜尋 (Discovery)
```
首頁（社區動態） → 看到有興趣的商品 →
點擊查看詳情 → 瀏覽商品與留言 → 發表留言詢問
```
**設計重點:**
- 首頁以卡片瀑布流呈現
- 商品卡顯示：照片、標題、價格、發布時間、留言數
- 社區切換器（下拉選擇附近社區）
- 分類標籤快速切換

#### 4. 留言互動 (Comment Interaction - 公開+隱私)
```
商品詳情頁瀏覽 → 下滑查看現有留言（公開+隱私） →
點擊「留言」→ 選擇「公開」或「🔒僅賣家可見」→
輸入留言內容（或使用快速範本）→ 發送留言 →
賣家立即收到推播通知 → 賣家回覆留言 →
留言者收到推播通知 → 查看回覆 →
私下約定面交細節（建議使用隱私留言）→ 交易完成後互評
```
**設計重點:**
- 留言區顯示在商品詳情下方
- 公開留言完整顯示，隱私留言顯示🔒圖示（非當事人看不到內容）
- 留言輸入框有明顯的「公開/隱私」切換開關
- 快速留言範本根據公開/隱私預設選擇
- 賣家回覆有特殊標記（「賣家」標籤、不同背景色）
- 推播通知即時送達（< 5秒）
- 點擊通知直接跳轉到留言位置
- 賣家可以標記「已預訂」狀態（自動在留言區顯示）

#### 5. 評價回饋 (Rating)
```
交易完成通知 → 點擊「評價」→
選擇星等 → 可選填文字 → 送出評價
```
**設計重點:**
- 簡化流程（不強制寫評語）
- 預設正面評價（只有不滿意才需要特別說明）
- 雙向匿名（評價者與被評者互不知道是誰先評）

---

## 功能需求

### FR-001: 使用者註冊與登入

**描述:** 使用者透過第三方服務（Google、Apple、LINE）進行快速註冊與登入。

**需求細節:**
- 支援第三方登入：
  - **Google Sign-In** - Google帳號登入
  - **Apple Sign-In** - Apple ID登入（iOS必備）
  - **LINE Login** - LINE帳號登入（台灣熱門）
- 首次登入視為註冊，自動建立帳號
- 自動獲取第三方資料：
  - 姓名（可編輯）
  - Email
  - 頭像（可更換）
- 自動登入機制（Token持久化）
- 登出功能
- 帳號綁定管理（可綁定多個第三方帳號）

**驗收標準:**
- 使用者可選擇任一第三方服務登入
- 首次登入成功自動建立帳號
- 第三方資料正確匯入
- 登入狀態持久保存
- 可登出後重新登入
- iOS版本必須支援Apple Sign-In（App Store要求）

**產品魔力體現:**
一鍵登入，無需記憶密碼，降低註冊門檻。使用者熟悉的登入方式，提升信任感。

---

### FR-002: 社區身份驗證（QR Code + 門牌綁定）

**描述:** 使用者前往社區管理室，由管理員透過後台產生專屬QR Code，住戶掃描後綁定門牌號碼，完成社區身份驗證。

**需求細節:**

**住戶端流程：**
1. 下載App並完成第三方登入
2. 點擊「驗證社區身份」
3. 前往社區管理室
4. 開啟App的QR Code掃描功能
5. 掃描管理員提供的專屬QR Code
6. 系統自動帶入社區資訊與門牌號碼
7. 確認資訊後完成綁定
8. 顯示「歡迎加入【XX社區】XX號」

**管理員後台流程（Web後台）：**
1. 登入管理員後台
2. 選擇社區與住戶地址（例：A棟3樓301號）
3. 系統產生該地址專屬的QR Code
4. 顯示QR Code給住戶掃描
5. 掃描成功後記錄綁定時間與住戶資訊

**QR Code資訊結構：**
```json
{
  "community_id": "社區ID",
  "community_name": "社區名稱",
  "building": "A棟",
  "floor": "3樓",
  "unit": "301號",
  "address": "完整地址",
  "verification_token": "一次性驗證Token"
}
```

**額外功能：**
- 支援綁定多個社區（多處房產擁有者）
- 可切換主要社區
- 可解除綁定（需管理員審核）
- 管理員可查看已驗證住戶列表

**「稍後驗證」功能邊界：**

使用者可選擇「稍後驗證」延後完成社區綁定，但功能會受到限制。

**未驗證使用者可以：**
- ✅ 瀏覽社區商品列表（首頁動態）
- ✅ 查看商品詳情（包含照片、描述、價格）
- ✅ 使用搜尋功能（關鍵字搜尋、分類瀏覽）
- ✅ 查看公開留言（但看不到隱私留言）
- ✅ 查看賣家的公開資訊（暱稱、評分、交易次數）

**未驗證使用者不可以：**
- ❌ 發布商品（提示：「完成社區驗證後即可發布商品」）
- ❌ 發表留言（提示：「完成社區驗證後即可留言」）
- ❌ 查看賣家詳細資訊（無法進入賣家個人主頁）
- ❌ 進行交易（無法標記已售出、無法評價）
- ❌ 使用檢舉功能
- ❌ 查看隱私留言

**引導驗證機制：**
- App首頁頂部顯示橫幅提示：「⚠️ 完成社區驗證，解鎖完整功能」
- 點擊「發布」「留言」等受限功能時，彈出提示視窗：
  - 「此功能需要完成社區驗證」
  - 顯示驗證流程說明
  - 提供「前往驗證」按鈕（跳轉到QR Code掃描頁面）
- 每次開啟App時（前3次），顯示驗證引導畫面

**設計理念：**
允許「試用」但限制「參與」，讓使用者先體驗平台價值（瀏覽商品），再引導完成驗證以解鎖完整功能。降低初期門檻，提升轉換率。

**驗收標準:**
- QR Code掃描成功率 > 95%
- 掃描後自動帶入正確的社區與門牌資訊
- 綁定成功後立即可瀏覽社區商品
- 驗證Token僅能使用一次（防止重複使用）
- 管理員可查看驗證紀錄
- 可管理已加入的社區列表

**安全機制：**
- QR Code包含一次性Token，掃描後失效
- Token有效期限5分鐘
- 管理員操作需要身份驗證
- 綁定記錄包含IP位址與時間戳記

**產品魔力體現:**
管理室是社區的信任中心，透過管理員驗證確保只有真實住戶能加入。掃描QR Code的瞬間，住戶正式成為「數位社區」的一份子。

---

### FR-003: 個人資料管理

**描述:** 使用者可設定和編輯個人資料。

**需求細節:**
- 必填欄位：暱稱（2-20字元）
- 選填欄位：頭像照片、個人簡介（50字內）
- 系統資訊：信用評分、交易次數、加入日期
- 顯示已加入的社區列表

**驗收標準:**
- 暱稱不可重複（同社區內）
- 頭像支援相機拍攝或相簿選擇
- 頭像自動裁切為正方形
- 資料儲存成功後顯示確認訊息
- 其他使用者可查看公開資料（暱稱、頭像、評分、交易次數）

---

### FR-004: 商品發布（簡化版）

**描述:** 使用者以最簡單的方式快速發布商品到所屬社區。

**需求細節:**

**必填欄位：**
1. **商品照片**（固定4張）
   - 必須上傳4張照片
   - 支援拍照或相簿選擇
   - 照片自動壓縮（單張 < 1MB）
   - 照片可調整順序
   - 建議拍攝：正面、側面、細節、使用場景

2. **商品狀態**（單選）
   - 🆕 **全新** - 未使用過的商品
   - ♻️ **二手** - 使用過的商品

3. **商品資訊來源**（選填但建議）
   - 商品網址連結（例：原購買網站、品牌官網）
   - 系統會自動抓取網頁標題與縮圖（若可用）
   - 若無法自動抓取，使用者需手動填寫標題

4. **商品標題**（必填）
   - 3-50字
   - 若有提供網址且成功抓取，自動帶入
   - 可手動編輯修改

5. **商品摘要**（必填）
   - 20-200字
   - 描述商品狀況、購買原因、出售原因等
   - 提供範本建議：
     - 「購買時間：XXXX年，使用狀況良好」
     - 「因搬家出清，功能正常」
     - 「孩子長大用不到了，九成新」

6. **使用時間**（必填）
   - 選擇時間區間：
     - 未使用（全新）
     - 使用不到1個月
     - 使用1-6個月
     - 使用6個月-1年
     - 使用1-3年
     - 使用3年以上

7. **價格設定**（必填）
   - 固定價格（輸入數字）
   - 可議價（勾選）
   - 免費贈送（選項）

8. **發布社區**（必填）
   - 若加入多個社區，選擇要發布到哪個社區
   - 預設為主要社區

**商品分類（自動化）：**
- 系統透過商品網址自動判斷分類
- 若無網址或無法判斷，使用者手動選擇
- 預設分類清單：
  1. 家具家飾
  2. 家電用品
  3. 3C產品
  4. 嬰幼兒用品
  5. 書籍文具
  6. 衣物配件
  7. 運動休閒
  8. 其他

**發布流程：**
```
1. 拍攝/選擇4張照片 →
2. 選擇全新/二手 →
3. 貼上商品網址（選填）→
4. 確認/編輯標題 →
5. 填寫摘要 →
6. 選擇使用時間 →
7. 設定價格 →
8. 確認發布
```

**驗收標準:**
- 必須上傳4張照片才能繼續
- 照片自動壓縮並上傳
- 提供商品網址時，自動抓取標題（支援主流電商網站）
- 所有必填欄位完成才可發布
- 發布成功後自動跳轉到商品詳情頁
- 商品立即出現在社區動態中
- 整個發布流程 < 2分鐘完成

**產品魔力體現:**
簡化到極致的發布流程，讓阿姨阿伯也能輕鬆上架。4張照片講清楚商品全貌，網址連結讓買家快速了解商品規格，不需要重新打字說明。

**商品網址抓取技術方案:**

使用Supabase Edge Function實現網址metadata抓取功能。

**支援網站列表：**
- momo購物 (momoshop.com.tw)
- 蝦皮購物 (shopee.tw)
- PChome 24h購物 (24h.pchome.com.tw)
- Yahoo購物中心 (tw.buy.yahoo.com)
- 其他支援Open Graph的網站

**實作流程：**
```
1. 使用者貼上商品網址
   ↓
2. Flutter App呼叫 Supabase Edge Function: fetch-url-metadata
   ↓
3. Edge Function 抓取網頁內容
   ↓
4. 解析 Open Graph / Meta tags
   ↓
5. 回傳：標題、描述、圖片URL、價格（若有）
   ↓
6. App自動帶入標題欄位
```

**抓取資料（Open Graph Protocol）：**
```html
<meta property="og:title" content="商品標題" />
<meta property="og:description" content="商品描述" />
<meta property="og:image" content="商品圖片URL" />
<meta property="product:price:amount" content="999" />
```

**Edge Function實作（TypeScript）：**
```typescript
// Supabase Edge Function: fetch-url-metadata
import { serve } from "https://deno.land/std@0.168.0/http/server.ts"
import * as cheerio from "https://esm.sh/cheerio@1.0.0-rc.12"

serve(async (req) => {
  const { url } = await req.json()

  // 1. 驗證網址格式
  if (!isValidURL(url)) {
    return new Response(JSON.stringify({ error: "無效網址" }), { status: 400 })
  }

  // 2. 抓取網頁
  const response = await fetch(url, {
    headers: { 'User-Agent': 'NeighborMarket/1.0' }
  })
  const html = await response.text()

  // 3. 解析Open Graph
  const $ = cheerio.load(html)
  const metadata = {
    title: $('meta[property="og:title"]').attr('content') || $('title').text(),
    description: $('meta[property="og:description"]').attr('content'),
    image: $('meta[property="og:image"]').attr('content'),
    price: $('meta[property="product:price:amount"]').attr('content'),
    source: new URL(url).hostname
  }

  return new Response(JSON.stringify(metadata), {
    headers: { "Content-Type": "application/json" }
  })
})
```

**錯誤處理：**
- 網址無法訪問 → 提示「無法抓取商品資訊，請手動輸入標題」
- 網站不支援Open Graph → 提示「此網站不支援自動抓取，請手動輸入」
- 抓取超時（> 5秒）→ 取消並提示手動輸入
- 顯示載入動畫（抓取中...）

**快取機制：**
- 已抓取過的URL儲存到 `url_metadata_cache` 表
- 快取有效期：7天
- 相同URL直接返回快取資料（減少外部請求）

**隱私考量：**
- 不儲存完整URL（僅儲存domain + hash）
- 不追蹤使用者瀏覽行為
- 符合GDPR規範

**成本估算：**
- Supabase Edge Functions: 免費額度500K請求/月
- 預估每個商品發布1次請求
- MVP階段成本: $0

---

### FR-005: 商品列表與動態

**描述:** 首頁顯示所屬社區的最新商品動態。

**需求細節:**
- 預設顯示主要社區的商品
- 商品卡顯示：主圖、標題、價格、發布時間、留言數、距離標示
- 依發布時間倒序排列（最新在上）
- 下拉重新整理
- 滾動載入更多（分頁載入）
- 商品狀態標籤（已售出、已預訂商品顯示灰色）

**社區切換:**
- 頂部社區選擇器
- 切換社區後刷新商品列表
- 記住使用者最後選擇的社區

**驗收標準:**
- 頁面載入時間 < 2秒
- 至少載入20件商品
- 無商品時顯示空狀態提示
- 已售出商品自動排到最後
- 點擊商品卡進入商品詳情

---

### FR-006: 商品詳情

**描述:** 顯示商品完整資訊、賣家資料與留言區。

**需求細節:**

**商品資訊區：**
- **照片輪播**（4張照片）
  - 支援左右滑動、點擊放大
  - 顯示照片指示器（1/4）
  - 放大模式可左右滑動切換
- **商品標題與價格**（醒目顯示）
  - 價格旁顯示「可議價」標籤（若適用）
  - 免費贈送顯示為「免費」
- **商品狀態標籤**
  - 🆕 全新 / ♻️ 二手
  - 上架中 / 已預訂 / 已售出
- **使用時間**（二手商品顯示）
  - 例：「使用6個月-1年」
  - 全新商品顯示「未使用」
- **商品摘要**（賣家填寫的描述）
  - 完整顯示200字內容
  - 支援換行與emoji
- **商品資訊來源**（若有提供）
  - 顯示「🔗 商品連結」按鈕
  - 點擊開啟外部瀏覽器查看原始商品頁面
  - 顯示網址來源（例：「來自 momo購物」）
- **商品分類**
  - 分類標籤（例：#家電用品）
- **發布時間**
  - X分鐘前、X小時前、X天前

**賣家資訊區塊：**
- 頭像、暱稱、社區認證徽章
- 信用評分（星星顯示）
- 交易次數（買入X次、賣出X次）
- 所屬社區（例：「陽光社區 A棟」）
- 點擊可查看賣家主頁（查看其他商品）

**留言區：**
- 顯示所有留言（按時間排序）
  - 公開留言：完整顯示
  - 隱私留言：僅賣家與留言者可見，其他人看到「🔒 私密留言」
- 留言輸入框（固定在底部）
  - 公開/隱私切換開關
  - 快速留言按鈕
- 留言計數顯示（例：「15則留言」）

**操作按鈕：**
- 一般使用者：
  - 「留言」按鈕（展開輸入框或捲動到輸入框）
  - 「檢舉」按鈕（檢舉不當商品）
  - 「分享」按鈕（Phase 2）
- 自己的商品：
  - 「編輯」商品資訊
  - 「刪除」商品
  - 「標記為已預訂」
  - 「標記為已售出」（進入選擇買家流程）
  - 「下架」商品

**驗收標準:**
- 圖片放大後可左右滑動切換
- 商品網址可正確開啟外部瀏覽器
- 使用時間正確顯示
- 點擊賣家資訊可查看賣家主頁
- 已售出商品顯示「此商品已售出」狀態且留言輸入框禁用
- 留言區即時更新
- 隱私留言權限正確（僅賣家與留言者可見）
- 自己的商品可管理留言（刪除不當留言）
- 所有按鈕功能正常運作

---

### FR-007: 商品管理

**描述:** 使用者可管理自己發布的商品。

**需求細節:**
- 我的商品列表（個人中心）
- 商品狀態分類：
  - 上架中
  - 已預訂
  - 已售出
  - 已下架
- 編輯商品（修改標題、價格、描述、照片）
- 狀態管理：
  - 標記為已預訂（暫時保留給特定買家）
  - 標記為已售出（選擇成交買家，觸發交易確認流程）
  - 下架商品
- 重新上架（將已下架或已預訂商品重新發布）
- 刪除商品（永久刪除）
- 留言管理（查看與刪除商品的留言）

**驗收標準:**
- 編輯後即時更新商品詳情
- 標記已售出後進入選擇買家流程
- 已預訂商品在動態中顯示「已預訂」標籤，但仍可瀏覽
- 刪除前需要二次確認
- 已售出商品可重新上架（狀態變回上架中）
- 狀態變更後留言區會顯示對應提示

---

### FR-008: 分類瀏覽

**描述:** 使用者可依照商品分類瀏覽特定類別的商品。

**需求細節:**
- 分類導航列（橫向滾動的分類標籤）
- 點擊分類後篩選該類別商品
- 保持在當前社區範圍內
- 分類計數顯示（每個分類下的商品數量）

**驗收標準:**
- 選中分類高亮顯示
- 篩選結果即時更新
- 無商品分類顯示「此分類暫無商品」
- 可快速切換不同分類

---

### FR-009: 關鍵字搜尋

**描述:** 使用者可透過關鍵字搜尋商品。

**需求細節:**
- 搜尋框（頂部固定）
- 即時搜尋（輸入時即時顯示結果）
- 搜尋範圍：商品標題、描述
- 搜尋歷史紀錄（顯示最近5筆）
- 熱門搜尋關鍵字（顯示當前熱門搜尋）

**驗收標準:**
- 輸入2個字元以上才開始搜尋
- 搜尋結果依相關度排序
- 無結果時顯示「找不到相關商品」提示
- 可清除搜尋歷史

---

### FR-010: 商品留言板（公開+隱私留言）

**描述:** 使用者可在商品頁面發表公開或隱私留言，與賣家或其他使用者互動。賣家收到留言時會立即收到推播通知。

**需求細節:**

**留言類型：**
1. **公開留言** - 社區內所有人可見
2. **隱私留言** - 僅賣家與留言者可見（以🔒圖示標記）

**留言發布：**
- 留言顯示區（商品詳情下方）
- 文字留言（最多200字）
- 發布時選擇「公開」或「僅賣家可見」
- **一鍵議價功能** 💰
  - 留言輸入框上方顯示「💰 議價」按鈕
  - 點擊後彈出議價介面：
    - 顯示商品原價（例：NT$ 1,000）
    - 滑桿或數字輸入框設定期望價格
    - 自動計算折扣百分比（例：「原價8折」）
    - 可選擇「立即議價」或「先詢問」
  - 送出後自動產生議價留言（預設隱私）：
    - 「您好，我想以 NT$ 800（原價8折）購買此商品，請問可以嗎？」
  - 賣家收到議價通知（特殊標記 💰 議價留言）
  - 賣家可一鍵回覆：「接受」「拒絕」「再議」
    - 接受 → 自動回覆「好的，就這個價格！請問何時方便面交？」
    - 拒絕 → 自動回覆「抱歉，這個價格無法接受」
    - 再議 → 自動回覆「可以 NT$ ___ 嗎？」（賣家填入反議價）
- 快速留言範本（傳統留言）：
  - 「還有嗎？」（預設公開）
  - 「可以便宜一點嗎？」（預設隱私）→ **建議改用一鍵議價功能**
  - 「可以面交嗎？」（預設公開）
  - 「什麼時候方便？」（預設隱私）
  - 「我有興趣！」（預設公開）
  - 「請問使用狀況如何？」（預設公開）
- 支援emoji輸入
- 留言輸入框（固定在底部）

**留言顯示：**
- 留言排序：依時間倒序（最新在上）
- 公開留言顯示：
  - 留言者頭像、暱稱、社區認證徽章
  - 留言內容
  - 留言時間（X分鐘前、X小時前）
  - 賣家回覆（以縮排或特殊背景色顯示，標記「賣家回覆」）
- 隱私留言顯示：
  - 對其他人顯示為「🔒 私密留言」（隱藏內容）
  - 僅賣家與留言者可看到完整內容
  - 留言者自己看到的隱私留言有淺色背景標示
  - 顯示「僅你和賣家可見」提示

**留言通知（推播）：**
- 賣家收到新留言時：
  - 推播通知：「【商品名稱】收到新留言」
  - 通知內容：留言者暱稱 + 留言摘要（前30字）
  - 公開/隱私留言都會推播
  - 點擊通知跳轉到商品頁面並捲動到該留言
- 留言者收到賣家回覆時：
  - 推播通知：「賣家回覆了你的留言」
  - 通知內容：賣家暱稱 + 回覆摘要
  - 點擊通知跳轉到商品頁面

**賣家特殊功能：**
- 回覆留言（公開或隱私留言都可回覆）
  - 回覆公開留言 → 回覆也是公開
  - 回覆隱私留言 → 回覆也是隱私
- 刪除不當留言（自己商品的留言）
- 查看所有留言（包含隱私留言）
- 留言管理介面（標記重要留言、快速回覆）

**隱私設定：**
- 使用者可設定「預設留言為隱私」
- 敏感內容自動建議使用隱私留言（例如包含電話、地址）
- 首次使用隱私留言時顯示說明

**驗收標準:**
- 留言即時顯示（< 2秒）
- 推播通知延遲 < 5秒
- 賣家回覆有明顯視覺區分
- 隱私留言僅賣家與留言者可見
- 已售出商品無法留言
- 留言數量即時更新（公開+隱私）
- 支援emoji與特殊符號
- 留言可以複製文字
- 推播通知可正常接收並跳轉

**推播通知需求（MVP即包含）：**
- 使用Firebase Cloud Messaging (FCM)
- 支援iOS與Android
- 使用者可在設定中關閉留言通知
- 夜間模式（23:00-08:00）靜音通知
- 通知分組（同一商品的多個留言合併顯示）

**產品魔力體現:**
公開留言建立社區信任感，隱私留言保護敏感資訊。賣家第一時間收到推播，不會錯過任何潛在買家。

---

### FR-011: 留言通知與管理

**描述:** 使用者可查看所有留言通知，管理與自己相關的留言互動。

**需求細節:**
- 通知中心（顯示留言相關通知）
- 通知類型：
  - 我的商品收到新留言
  - 我的留言被賣家回覆
  - 我關注的商品有新留言（Phase 2）
- 通知列表顯示：
  - 通知類型圖示
  - 留言者頭像、暱稱
  - 留言內容摘要（前30字）
  - 商品縮圖與標題
  - 時間
  - 未讀標記（紅點）
- 點擊通知跳轉到對應商品頁面的留言位置
- 我的留言管理：
  - 查看我發布的所有留言
  - 查看我收到的所有留言（賣家視角）
  - 可刪除自己的留言

**驗收標準:**
- 新留言即時通知（App內通知，Phase 2支援推播）
- 未讀通知紅點提示
- 點擊通知後標記為已讀
- 通知保存30天
- 可批次清除已讀通知

---

### FR-012: 交易完成確認

**描述:** 買賣雙方確認交易完成並記錄交易對象。

**需求細節:**
- 賣家端操作：
  - 在商品管理頁面點擊「標記為已售出」
  - 系統顯示該商品的所有留言者列表
  - 賣家選擇實際成交的買家（從留言者中選擇）
  - 確認後商品狀態變更為「已售出」
- 買家端確認：
  - 買家收到通知「您是否完成了【商品名稱】的交易？」
  - 買家確認後：
    - 觸發雙方評價流程
    - 雙方交易次數+1
    - 交易紀錄保存
- 若買家未確認：
  - 7天後自動確認交易完成
  - 仍會建立交易紀錄，但不強制評價
- 賣家也可以選擇「私下交易」（未在留言中的買家）
  - 需要輸入買家社區代碼或暱稱搜尋
  - 僅在同社區內搜尋

**驗收標準:**
- 賣家可正確選擇成交買家
- 買家收到交易確認通知
- 雙方確認後觸發評價流程
- 交易紀錄正確記錄雙方資訊
- 私下交易也能正常建立交易紀錄

**產品魔力體現:**
透過留言紀錄，系統能智能推薦最可能成交的買家，簡化賣家的操作流程。

---

### FR-013: 評價系統

**描述:** 交易完成後，買賣雙方可互相評價。

**需求細節:**
- 評價介面（交易完成後彈出提示）
- 評價內容：
  - 星等評分（1-5星）
  - 文字評價（選填，最多100字）
- 評價匿名性（對方不知道誰先評價）
- 雙方評價後才顯示彼此評價內容
- 評價無法修改（送出後鎖定）

**驗收標準:**
- 評價成功後更新信用分數
- 可跳過評價（7天後自動關閉評價視窗）
- 評價顯示在個人主頁
- 平均評分自動計算

---

### FR-020: 彈性交易模式（管理室代收、面交地點）

**描述:** 提供多種彈性的交易取貨方式，讓買賣雙方可依照便利性選擇最適合的交易地點。

**需求細節:**

**支援的交易模式：**

1. **管理室代收** 🏢
   - 賣家將商品交給管理室保管
   - 管理室提供臨時寄放服務
   - 買家到管理室取貨並付款
   - 管理員確認交易完成

2. **社區公共區域面交** 🏛️
   - 社區大廳
   - 社區中庭
   - 郵件室/包裹室
   - 其他公共空間

3. **門口/樓下面交** 🚪
   - 社區大門
   - 特定樓層樓梯間
   - 雙方約定地點

**交易模式選擇流程：**

```
買賣雙方在留言中達成共識 →
賣家在「標記為已售出」時選擇交易模式 →
系統記錄交易地點 →
（若選擇管理室代收）通知管理員 →
交易完成後雙方確認與評價
```

**管理室代收功能詳細：**

**賣家端：**
1. 與買家約定好後，選擇「管理室代收」
2. 系統產生「代收編號」（6位數字）
3. 賣家將商品送至管理室，告知代收編號
4. 管理員在後台系統登記「已收到商品」
5. 買家收到通知「商品已送達管理室，請攜帶編號前往取貨」

**買家端：**
1. 收到「商品已送達」推播通知
2. 前往管理室，告知代收編號
3. 管理員核對編號，交付商品
4. 買家現場驗貨
5. 買家現場付款（現金交給管理員）
6. 管理員代為轉交現金給賣家（賣家下次經過管理室領取）
7. 管理員在後台確認「已取貨」
8. 系統通知雙方「交易完成」，觸發評價流程

**管理員端（Web後台）：**
1. **代收商品管理介面**
   - 顯示待處理代收清單
   - 欄位：代收編號、賣家、買家、商品名稱、金額、狀態
   - 狀態：待送達、已收到、已取貨、已完成
2. **登記收到商品**
   - 掃描或輸入代收編號
   - 確認商品與賣家身份
   - 標記「已收到商品」
   - 拍照留存（選填）
3. **登記已取貨**
   - 買家出示代收編號
   - 確認買家身份（檢查App中的暱稱或頭像）
   - 商品交給買家
   - 收取現金
   - 標記「已取貨」
4. **現金管理**
   - 記錄收到的現金金額
   - 待賣家領取現金清單
   - 現金交付記錄
5. **歷史記錄查詢**
   - 查看所有代收交易記錄
   - 匯出報表（Excel）

**面交地點建議：**
- 系統提供社區內常用面交地點清單
- 地點標記：
  - 📹 有監視器（安全）
  - 🏢 管理室可見範圍（安全）
  - 🌞 白天明亮（建議白天交易）
- 買家可查看地點位置圖（若社區有提供平面圖）

**安全提示：**
- 建議交易時間：白天或管理室有人時段
- 建議地點：有監視器或人潮的公共區域
- 驗貨提醒：取貨時當場驗貨，確認無誤再付款
- 金額核對：付款前再次確認金額

**現金交易機制（MVP階段）：**
- ✅ 僅支援現金付款
- ❌ 不支援線上支付（Phase 2功能）
- ❌ 不支援第三方支付（Phase 2功能）
- 管理室代收時，管理員代為收取現金並轉交
- 面交時，買賣雙方現場現金交易
- 系統不涉及金流處理

**驗收標準:**
- 交易時可選擇三種交易模式
- 選擇管理室代收時，系統產生唯一代收編號
- 管理員可在後台查看待處理代收清單
- 管理員可登記「已收到商品」「已取貨」
- 買家收到「商品已送達」推播通知
- 代收編號不重複
- 交易完成後記錄交易模式
- 現金交易流程清楚提示

**產品魔力體現:**
不用擔心時間配合不上！賣家可以先把商品放管理室，買家有空再去拿，管理室成為社區的「交易中繼站」。對長輩或上班族特別友善，完全不需要線上支付，現金交易最安心。

---

### FR-014: 個人主頁

**描述:** 顯示使用者的公開資訊與商品列表。

**需求細節:**
- 個人資訊：
  - 頭像、暱稱
  - 信用評分（星級顯示）
  - 交易次數（買入X次、賣出X次）
  - 加入時間
  - 所屬社區
- 正在出售的商品列表
- 收到的評價列表（顯示最新5筆）
- 其他使用者可查看（買家評估賣家可信度）

**驗收標準:**
- 點擊商品可進入詳情頁
- 評價顯示評價者暱稱、時間、內容
- 自己的主頁可編輯資料

---

### FR-015: 檢舉機制

**描述:** 使用者可檢舉不當商品或不良使用者。

**需求細節:**
- 檢舉入口：
  - 商品詳情頁「檢舉商品」按鈕
  - 留言區長按留言「檢舉此留言」
  - 使用者主頁「檢舉使用者」
- 檢舉原因選項：
  - 販售違禁品
  - 詐騙行為
  - 不實商品描述
  - 騷擾或不當言論
  - 其他（需填寫說明）
- 檢舉後提交到後台審核
- 檢舉成功後顯示確認訊息

**驗收標準:**
- 檢舉原因為必選
- 可附上截圖證據（選填）
- 檢舉後可選擇封鎖該使用者
- 重複檢舉同一對象有提示

---

### FR-016: 封鎖功能

**描述:** 使用者可封鎖不想互動的對象。

**需求細節:**
- 封鎖入口：
  - 個人主頁「封鎖」按鈕
  - 聊天室選單「封鎖」
- 封鎖效果：
  - 對方無法查看我的商品
  - 對方無法聯絡我
  - 我不會看到對方的商品
- 封鎖名單管理（設定頁面）
- 可解除封鎖

**驗收標準:**
- 封鎖前二次確認
- 封鎖後立即生效
- 封鎖名單可查詢
- 解除封鎖立即恢復正常互動

---

### FR-017: 交易紀錄

**描述:** 使用者可查詢歷史交易紀錄。

**需求細節:**
- 交易列表分類：
  - 我買到的
  - 我賣出的
- 每筆交易顯示：
  - 商品圖片與標題
  - 交易對象
  - 交易日期
  - 交易金額
  - 評價狀態（已評價/未評價）
- 點擊交易可查看詳情
- 未評價的交易可補評價（7天內）

**驗收標準:**
- 交易紀錄保存完整
- 依時間倒序排列
- 可搜尋交易紀錄

---

### FR-018: 社區認證徽章

**描述:** 已驗證社區身份的使用者顯示認證徽章。

**需求細節:**
- 認證徽章圖示（藍色勾勾）
- 徽章顯示位置：
  - 個人主頁
  - 商品詳情的賣家資訊
  - 留言區的留言者名稱旁
  - 通知列表
- 滑鼠hover顯示「已驗證社區成員」tooltip

**驗收標準:**
- 完成社區代碼驗證的使用者自動獲得徽章
- 徽章在各處一致顯示

---

### FR-019: 管理員後台系統（Web）

**描述:** 社區管理員透過Web後台管理社區資訊、產生住戶驗證QR Code，並查看驗證記錄。

**需求細節:**

**管理員登入：**
- 使用Email + 密碼登入
- 支援管理員帳號管理（由超級管理員建立）
- 登入後顯示管理的社區清單
- 支援管理多個社區（同一管理員可管理多個社區）

**社區管理介面：**
1. **社區資訊管理**
   - 新增社區（社區名稱、地址、建築數量）
   - 編輯社區資訊
   - 啟用/停用社區
   - 社區設定（管理室開放時間、聯絡電話）

2. **建築與門牌管理**
   - 建立建築結構（例：A棟、B棟、C棟）
   - 設定樓層數量（例：1樓-15樓）
   - 設定門牌號碼（例：101、102、201、202）
   - 批次匯入門牌資料（CSV上傳）
   - 門牌狀態管理（已驗證/未驗證/已出租/空屋）

3. **QR Code產生器**
   - 選擇社區 → 選擇建築 → 選擇樓層 → 選擇門牌
   - 系統自動產生該門牌專屬的QR Code
   - QR Code即時顯示（可全螢幕放大讓住戶掃描）
   - 顯示QR Code有效期限（5分鐘倒數計時）
   - 可下載QR Code圖片（PNG格式）
   - 可列印QR Code（含門牌資訊）
   - QR Code包含一次性Token（掃描後失效）
   - 可重新產生QR Code（舊的自動失效）

4. **已驗證住戶列表**
   - 顯示所有已驗證的住戶資訊：
     - 門牌號碼
     - 住戶暱稱
     - 驗證時間
     - 登入方式（Google/Apple/LINE）
     - 最後活躍時間
   - 搜尋功能（依門牌或暱稱）
   - 篩選功能（依建築、樓層、驗證時間）
   - 匯出功能（Excel格式）

5. **驗證記錄查詢**
   - 驗證歷史記錄：
     - 驗證時間
     - 門牌號碼
     - 住戶資訊
     - IP位址
     - 操作管理員
     - 驗證狀態（成功/失效/過期）
   - 異常記錄警示（重複驗證、異常IP）
   - 記錄保存90天

6. **數據統計面板（Dashboard）**
   - 社區總住戶數
   - 已驗證住戶數 / 驗證率
   - 本週新增驗證數量
   - 活躍使用者數（近7天有登入）
   - 社區商品數量
   - 社區交易次數
   - 圖表顯示（驗證趨勢、活躍度）

**權限管理：**
- 超級管理員（Super Admin）
  - 建立/管理社區
  - 建立/管理管理員帳號
  - 查看所有社區數據
- 社區管理員（Community Admin）
  - 管理指定社區的住戶驗證
  - 產生QR Code
  - 查看該社區的數據
- 操作記錄追蹤（誰在何時做了什麼操作）

**技術實作：**
- 使用React或Vue.js建立Web後台
- 響應式設計（支援平板、桌機）
- 連接Supabase後端
- QR Code使用qrcode.js生成
- 使用Supabase Row Level Security確保資料安全

**驗收標準:**
- 管理員可成功登入後台
- 可順利建立社區與門牌結構
- QR Code產生速度 < 1秒
- QR Code掃描成功率 > 95%
- 驗證記錄正確保存
- 住戶列表資料正確顯示
- 數據統計即時更新
- 權限控制正常運作（不同角色看到不同功能）
- 響應式設計在各裝置正常顯示

**產品魔力體現:**
管理員不需要複雜的操作，只要點幾下就能產生QR Code。住戶掃描後立刻完成驗證，整個流程行雲流水。數據面板讓管理員一眼看出社區的數位化進度。

---

## 非功能需求

### 效能需求

**回應時間:**
- 頁面載入時間 < 2秒（首次啟動）
- 頁面切換 < 300ms
- 留言發布與顯示 < 2秒
- 搜尋結果顯示 < 1秒
- 圖片載入採用漸進式載入（先顯示低解析度）

**併發處理:**
- 支援同時1000個活躍使用者（MVP）
- 未來擴展至10,000 MAU（成長期）

**資源使用:**
- App記憶體使用 < 200MB
- 電池消耗優化（背景不執行非必要任務）
- 流量優化（圖片壓縮、快取機制）

---

### 安全需求

**資料保護:**
- 密碼與敏感資料加密儲存
- HTTPS加密傳輸
- 防止SQL Injection、XSS攻擊
- API請求需要Token驗證

**隱私保護:**
- 不公開手機號碼
- 使用者可選擇隱藏真實姓名
- 留言為公開資訊（社區內可見），使用者需了解並同意
- 敏感議價資訊建議透過面交溝通（提示使用者）
- 遵守台灣個人資料保護法

**內容審核:**
- 禁止違法商品（毒品、槍械、色情）
- 敏感詞過濾機制
- 檢舉機制與人工審核

**防詐騙機制:**
- 信用評分機制
- 異常交易監控（短時間大量發布）
- 新帳號限制（註冊後24小時內發布數量限制）

---

### 可靠性需求

**服務可用性:**
- 系統正常運作時間 > 99%（每月停機時間 < 7.2小時）
- 自動錯誤監控與告警

**資料備份:**
- 每日自動備份資料庫
- 備份保存30天
- 災難復原計畫

**錯誤處理:**
- 網路錯誤友善提示（「網路連線不穩，請稍後再試」）
- 離線模式下可瀏覽已載入內容
- 自動重試機制（發送訊息失敗自動重試）

---

### 可維護性需求

**程式碼品質:**
- 使用Flutter最佳實踐
- 程式碼註解覆蓋率 > 30%
- 模組化架構設計

**測試:**
- 單元測試覆蓋率 > 60%
- 整合測試涵蓋關鍵流程
- 使用者驗收測試（UAT）

**監控與分析:**
- 整合Firebase Analytics
- 錯誤追蹤（Crashlytics）
- 使用者行為分析

---

### 擴展性需求

**架構設計:**
- 前後端分離
- RESTful API設計
- 支援水平擴展

**未來擴展考量:**
- 支援新增商品分類
- 支援多語言（未來國際化）
- 支援第三方登入（LINE Login）

---

### 無障礙需求

**銀髮友善:**
- 支援系統字體大小設定
- 高對比模式選項（Phase 2）
- 語音輸入支援（Phase 2）

**操作友善:**
- 觸控區域 > 44x44pt（符合iOS HIG）
- 重要操作有二次確認
- 錯誤訊息清晰易懂

---

## 補充需求（基於分析報告）

本節補充 Brainstorming Session 分析報告中識別的缺失需求，確保需求完整性。

### 錯誤處理和異常情況

#### FR-021: 交易失敗處理流程

**描述:** 當交易過程中發生異常情況時，系統需要提供明確的處理流程。

**需求細節:**
- **交易取消流程：**
  - 賣家可在「已預訂」狀態下取消預訂，系統通知買家，商品狀態自動變回「上架中」
  - 買家可在「已預訂」狀態下取消預訂，系統通知賣家，商品狀態自動變回「上架中」
  - 記錄取消原因（選填）

- **管理室代收異常處理：**
  - 商品未送達管理室：買家超過 24 小時未收到通知，系統自動提醒賣家
  - 商品遺失或損壞：管理員可標記「商品異常」，系統通知買賣雙方，提供爭議處理流程
  - 買家未取貨：商品送達管理室後 7 天未取貨自動提醒，14 天後自動取消交易

- **系統錯誤處理：**
  - 網路連線中斷：自動重試機制（最多 3 次），顯示友善錯誤訊息
  - 資料同步失敗：顯示「資料同步中，請稍候」，自動在背景重試同步

**驗收標準:**
- 所有異常情況都有對應的處理流程
- 錯誤訊息友善、清晰
- 使用者可以從錯誤中恢復
- 系統錯誤不會導致資料遺失

---

#### FR-022: 商品描述不符的爭議處理

**描述:** 當買家發現商品與描述不符時，需要提供明確的爭議處理機制。

**需求細節:**
- **爭議申訴流程：**
  - 買家在交易完成後 7 天內可提出爭議
  - 選擇爭議類型：商品描述不符、商品損壞或缺失、商品功能異常、其他
  - 上傳證據照片（最多 5 張）
  - 填寫爭議說明（必填，50-500 字）

- **賣家回應：**
  - 賣家收到「交易爭議通知」
  - 賣家可選擇：接受爭議、提出反駁（需提供證據）、請求平台仲裁

- **平台仲裁機制：**
  - 當買賣雙方無法達成共識時，可請求平台仲裁
  - 平台管理員查看爭議內容和證據並做出裁決
  - 裁決結果通知雙方，裁決後 3 天內可提出上訴（僅限一次）

- **爭議記錄：**
  - 所有爭議記錄保存在資料庫
  - 爭議記錄影響賣家信用評分
  - 多次爭議的賣家會被標記「高風險賣家」

**驗收標準:**
- 爭議申訴流程完整
- 證據上傳功能正常
- 平台仲裁機制運作正常
- 爭議記錄正確保存

---

#### FR-023: 支付糾紛處理機制

**描述:** 現金交易可能出現的支付糾紛需要明確的處理流程。

**需求細節:**
- **現金支付確認機制：**
  - 管理室代收現金：管理員在後台確認「已收到現金」，系統記錄收款時間和金額
  - 大廳面交現金：買賣雙方在 App 中確認「已完成現金交易」，系統記錄交易完成時間

- **支付糾紛處理：**
  - 金額不符：買家可提出「支付金額不符」爭議，系統記錄雙方聲稱的金額
  - 未收到款項：賣家可提出「未收到款項」爭議，系統檢查交易記錄

**驗收標準:**
- 現金支付確認機制正常運作
- 支付糾紛處理流程完整
- 交易記錄完整保存

---

### 數據隱私和安全

#### FR-024: 門牌號碼顯示規則

**描述:** 門牌號碼是敏感資訊，需要明確的顯示規則。

**需求細節:**
- **顯示規則：**
  - 對其他使用者：僅顯示「棟別」和「樓層」（例：「A棟 3樓」），不顯示完整門牌號碼
  - 對自己：顯示完整門牌號碼（例：「A棟 3樓 301號」）
  - 對管理員：可查看完整門牌號碼（用於驗證和管理）

- **隱私設定：**
  - 使用者可在設定中選擇是否顯示完整地址
  - 預設：僅顯示棟別和樓層

**驗收標準:**
- 門牌號碼顯示規則正確執行
- 隱私設定功能正常運作

---

#### FR-025: 個人資料保護措施

**描述:** 確保使用者個人資料的安全和隱私。

**需求細節:**
- **資料收集最小化：**
  - 僅收集必要的個人資料：暱稱（必填）、Email（可選）、頭像（可選）、社區資訊（必填）
  - 不收集：真實姓名、手機號碼、身份證字號、銀行帳號

- **資料儲存安全：**
  - 所有敏感資料加密儲存
  - 使用 Supabase Row Level Security (RLS) 確保資料存取權限
  - 定期安全審計

- **資料使用限制：**
  - 個人資料僅用於平台功能
  - 不向第三方分享個人資料
  - 不進行資料分析或廣告投放

**驗收標準:**
- 資料收集符合最小化原則
- 資料儲存安全機制正常運作
- 資料使用符合限制

---

#### FR-026: GDPR/個資法合規性

**描述:** 確保平台符合台灣個人資料保護法要求。

**需求細節:**
- **使用者權利：**
  - 資料查詢權：使用者可查看自己的所有個人資料，提供「下載我的資料」功能
  - 資料更正權：使用者可隨時更正自己的個人資料
  - 資料刪除權：使用者可申請刪除帳號和所有個人資料，刪除後 30 天內可恢復
  - 資料可攜權：使用者可下載自己的資料（JSON 格式）

- **隱私政策：**
  - 提供完整的隱私政策文件
  - 首次使用時顯示隱私政策
  - 使用者需同意隱私政策才能使用平台
  - 隱私政策更新時通知使用者

- **資料保留政策：**
  - 交易記錄保留 2 年
  - 評價記錄保留 2 年
  - 商品資料保留 1 年（下架後）
  - 個人資料保留至帳號刪除

**驗收標準:**
- 使用者權利功能正常運作
- 隱私政策完整且可存取
- 資料保留政策正確執行

---

### 管理室後台詳細需求

#### FR-027: 管理員權限管理

**描述:** 不同層級的管理員需要不同的權限。

**需求細節:**
- **權限層級：**
  - 超級管理員：建立和管理所有社區、建立和管理所有管理員帳號、查看所有社區的數據、系統設定和配置、爭議仲裁
  - 社區管理員：管理指定社區的住戶驗證、產生 QR Code、查看該社區的數據、管理該社區的代收商品
  - 管理室操作員：僅能操作代收商品管理、登記「已收到商品」、登記「已取貨」、現金管理

- **權限控制：**
  - 使用 Supabase Row Level Security (RLS) 實現權限控制
  - 每個操作都記錄操作者和時間
  - 敏感操作需要二次確認

**驗收標準:**
- 權限層級正確執行
- 權限控制機制正常運作
- 操作記錄完整保存

---

#### FR-028: 操作日誌記錄

**描述:** 記錄所有管理員的操作，用於審計和追蹤。

**需求細節:**
- **記錄內容：**
  - 操作時間、操作者（管理員帳號）、操作類型、操作對象、IP 位址、操作結果（成功/失敗）

- **日誌查詢：**
  - 管理員可查看自己的操作記錄
  - 超級管理員可查看所有操作記錄
  - 支援依時間、操作類型、操作者篩選
  - 日誌保留 90 天

**驗收標準:**
- 所有操作都正確記錄
- 日誌查詢功能正常運作
- 日誌保留時間正確

---

#### FR-029: 批量操作功能

**描述:** 管理員需要批量處理功能以提高效率。

**需求細節:**
- **批量操作類型：**
  - 批量產生 QR Code：選擇多個門牌號碼，一次產生多個 QR Code
  - 批量匯入門牌資料：上傳 CSV 檔案，自動解析並建立門牌資料
  - 批量標記驗證狀態：選擇多個住戶，批量標記為「已驗證」或「未驗證」

**驗收標準:**
- 批量操作功能正常運作
- 錯誤檢查和修正機制正常
- 操作結果正確

---

#### FR-030: 異常交易警示機制

**描述:** 當發現異常交易時，系統應自動警示管理員。

**需求細節:**
- **異常交易類型：**
  - 短時間大量交易：同一使用者 24 小時內完成 10 筆以上交易
  - 高金額交易：單筆交易金額超過 NT$ 10,000
  - 爭議交易：同一賣家多次被提出爭議
  - 異常 IP：同一帳號從多個不同 IP 登入

- **警示機制：**
  - 系統自動檢測異常交易
  - 發送警示通知給管理員
  - 管理員可查看異常交易詳情
  - 管理員可標記為「已處理」或「需進一步調查」

**驗收標準:**
- 異常交易檢測機制正常運作
- 警示通知正確發送
- 管理員可正確處理異常交易

---

### 使用者體驗細節

#### FR-031: 首次使用引導流程

**描述:** 新使用者需要引導以了解平台功能。

**需求細節:**
- **引導流程：**
  - 歡迎頁面：介紹平台核心價值
  - 登入引導：說明第三方登入方式
  - 社區驗證引導：說明社區驗證的重要性
  - 功能介紹：首次使用各功能時顯示引導

- **引導設定：**
  - 使用者可選擇「跳過引導」
  - 引導可隨時在設定中重新開啟
  - 引導使用互動式設計（點擊、滑動）

**驗收標準:**
- 引導流程完整
- 引導設定功能正常運作
- 使用者體驗良好

---

#### FR-032: 錯誤訊息設計

**描述:** 錯誤訊息應該友善、清晰，幫助使用者理解問題。

**需求細節:**
- **錯誤訊息原則：**
  - 友善的語言：避免技術術語，使用使用者能理解的語言
  - 明確的說明：清楚說明問題和解決方法
  - 視覺提示：使用圖示和顏色區分不同類型的錯誤

- **錯誤訊息類型：**
  - 網路錯誤：「網路連線不穩，請稍後再試」，提供「重試」按鈕
  - 驗證錯誤：「QR Code 已過期，請重新掃描」，提供「重新掃描」按鈕
  - 權限錯誤：「此功能需要完成社區驗證」，提供「前往驗證」按鈕
  - 資料錯誤：「請檢查輸入的資料是否正確」，標示錯誤欄位

**驗收標準:**
- 錯誤訊息友善、清晰
- 錯誤訊息提供解決方法
- 視覺提示正確

---

#### FR-033: 載入狀態處理

**描述:** 載入狀態應該提供良好的使用者體驗。

**需求細節:**
- **載入狀態類型：**
  - 頁面載入：顯示載入動畫（Skeleton Screen），顯示「載入中...」文字
  - 資料上傳：顯示上傳進度條，顯示「上傳中... X%」文字
  - 操作處理：顯示處理動畫，顯示「處理中...」文字

- **載入優化：**
  - 使用漸進式載入（先顯示基本內容，再載入詳細內容）
  - 使用快取減少載入時間
  - 預載入下一頁內容

**驗收標準:**
- 載入狀態提供良好體驗
- 載入優化機制正常運作

---

#### FR-034: 離線功能支援

**描述:** 當網路不穩定時，提供基本的離線功能。

**需求細節:**
- **離線功能範圍：**
  - 可離線使用：瀏覽已載入的商品列表、查看已載入的商品詳情、查看已載入的留言、查看個人資料和交易記錄、編輯草稿（未發布的商品）
  - 不可離線使用：發布新商品、發表新留言、完成交易確認、搜尋新商品

- **離線模式提示：**
  - 顯示「離線模式」提示
  - 顯示「正在同步資料」狀態
  - 網路恢復時自動同步

**驗收標準:**
- 離線功能正常運作
- 離線模式提示正確
- 資料同步機制正常

---

## 功能需求總覽（更新）

本 PRD 現在包含 **34 個功能需求**：

**MVP 核心功能（FR-001 至 FR-020）：**
- FR-001: 使用者註冊與登入
- FR-002: 社區身份驗證（QR Code + 門牌綁定）
- FR-003: 個人資料管理
- FR-004: 商品發布（簡化版）
- FR-005: 商品列表與動態
- FR-006: 商品詳情
- FR-007: 商品管理
- FR-008: 分類瀏覽
- FR-009: 關鍵字搜尋
- FR-010: 商品留言板（公開+隱私留言、一鍵議價、推播通知）
- FR-011: 留言通知與管理
- FR-012: 交易完成確認
- FR-013: 評價系統
- FR-014: 個人主頁
- FR-015: 檢舉機制
- FR-016: 封鎖功能
- FR-017: 交易紀錄
- FR-018: 社區認證徽章
- FR-019: 管理員後台系統（Web）
- FR-020: 彈性交易模式（管理室代收、大廳面交）

**補充需求（FR-021 至 FR-034）：**
- FR-021: 交易失敗處理流程
- FR-022: 商品描述不符的爭議處理
- FR-023: 支付糾紛處理機制
- FR-024: 門牌號碼顯示規則
- FR-025: 個人資料保護措施
- FR-026: GDPR/個資法合規性
- FR-027: 管理員權限管理
- FR-028: 操作日誌記錄
- FR-029: 批量操作功能
- FR-030: 異常交易警示機制
- FR-031: 首次使用引導流程
- FR-032: 錯誤訊息設計
- FR-033: 載入狀態處理
- FR-034: 離線功能支援

---

## 技術架構建議

### 前端技術棧

**Flutter Framework:**
- Flutter SDK 3.16+
- Dart 3.2+

**狀態管理:**
- Riverpod（推薦）- 強大的狀態管理與依賴注入

**本地儲存:**
- Brick（SQLite適配器）- 離線優先架構
- Shared Preferences - 使用者偏好設定

**關鍵套件:**
```yaml
dependencies:
  # 狀態管理
  flutter_riverpod: ^2.5.0

  # 路由導航
  go_router: ^13.0.0

  # Supabase後端服務
  supabase_flutter: ^2.0.0

  # 圖片處理
  cached_network_image: ^3.3.0
  image_picker: ^1.0.7
  image_cropper: ^5.0.1

  # 第三方登入
  google_sign_in: ^6.2.0
  sign_in_with_apple: ^5.0.0
  flutter_line_sdk: ^2.3.0

  # 推播通知（MVP即包含）
  firebase_messaging: ^14.7.0
  flutter_local_notifications: ^16.3.0

  # 工具類
  geolocator: ^11.0.0
  intl: ^0.19.0
  shimmer: ^3.0.0
  url_launcher: ^6.2.0  # 開啟商品網址連結
  qr_code_scanner: ^1.0.1  # QR Code掃描
```

---

### 後端技術

**Supabase（開源Firebase替代方案）**
- **Supabase Auth** - 使用者認證（支援第三方登入：Google、Apple、LINE）
- **PostgreSQL Database** - 關聯式資料庫（透過Supabase提供）
- **Supabase Storage** - 圖片儲存
- **Realtime** - 即時訂閱（留言即時更新）
- **Edge Functions** - Serverless 函式（後端邏輯）
- **Row Level Security (RLS)** - 資料庫層級權限控制

**選擇Supabase的優勢：**
- ✅ 開源，可自行部署，避免供應商鎖定
- ✅ PostgreSQL關聯式資料庫，資料結構更清晰
- ✅ 內建即時訂閱功能（適合留言板即時更新）
- ✅ 完整的第三方登入支援（Google、Apple、OAuth providers）
- ✅ 強大的RLS安全機制
- ✅ 免費額度適合MVP（500MB資料庫、1GB儲存、2GB頻寬）
- ✅ 完整的Flutter SDK支援
- ✅ RESTful API + GraphQL支援

**未來擴展考量：**
- Supabase可自行部署到私有伺服器
- 支援擴展到PostgreSQL生態系統工具
- 可整合其他服務（Redis、Elasticsearch等）

---

### 推播通知架構

**技術選擇：Firebase Cloud Messaging (FCM)**

由於Supabase不提供原生推播通知服務，我們使用FCM搭配Supabase實現推播功能。

**架構設計：**
```
使用者動作（發布留言）
    ↓
Supabase Database Insert
    ↓
Supabase Database Trigger（PostgreSQL Function）
    ↓
呼叫 Supabase Edge Function
    ↓
Edge Function 呼叫 FCM API
    ↓
FCM 推送通知到使用者裝置
```

**實作細節：**

1. **FCM Token管理**
   - 使用者登入後獲取FCM Token
   - Token儲存在Supabase `user_devices` 資料表
   - 欄位：`user_id`, `fcm_token`, `platform` (ios/android), `last_updated`
   - 支援多裝置（同一使用者可有多個Token）

2. **推播觸發機制**
   - 使用PostgreSQL Trigger監聽事件：
     - `comments` 表新增 → 通知商品擁有者
     - `comment_replies` 表新增 → 通知留言者
     - `transactions` 狀態更新 → 通知買賣雙方
     - `reviews` 表新增 → 通知被評價者
   - Trigger呼叫Supabase Edge Function

3. **Edge Function處理**
   ```typescript
   // Supabase Edge Function: send-notification
   - 接收通知參數（user_id, title, body, data）
   - 從資料庫查詢user的FCM tokens
   - 檢查使用者通知設定（是否關閉、夜間模式）
   - 呼叫FCM API發送推播
   - 記錄推播歷史到 `notification_logs` 表
   ```

4. **通知設定**
   - Supabase `user_notification_settings` 資料表
   - 欄位：
     - `comment_notifications`: boolean
     - `transaction_notifications`: boolean
     - `review_notifications`: boolean
     - `night_mode_enabled`: boolean
     - `night_mode_start`: time (預設 23:00)
     - `night_mode_end`: time (預設 08:00)

5. **FCM配置**
   - iOS: 配置APNs憑證
   - Android: 配置google-services.json
   - Flutter配置：`firebase_messaging` package
   - 背景訊息處理（Background Handler）
   - 前景訊息處理（Foreground Handler）

6. **通知類型與Deep Link**
   ```json
   {
     "notification": {
       "title": "【商品名稱】收到新留言",
       "body": "王小明：還有嗎？"
     },
     "data": {
       "type": "comment",
       "item_id": "123",
       "comment_id": "456",
       "deep_link": "neighbormarket://item/123?scroll_to=comment_456"
     }
   }
   ```
   - 點擊通知跳轉到對應商品頁面並捲動到留言位置

**安全性：**
- FCM Server Key 儲存在 Supabase Secrets（環境變數）
- Edge Function使用JWT驗證呼叫者身份
- RLS確保使用者只能查詢自己的Tokens

**成本估算：**
- FCM: 免費（無限推播）
- Supabase Edge Functions: 免費額度500K請求/月
- MVP階段成本: $0

---

## 實作規劃

### Epic分解（需進行）

本PRD包含20個功能需求，需要進一步分解為Epics與User Stories。

**功能需求概覽：**
- FR-001: 使用者註冊與登入（第三方登入）
- FR-002: 社區身份驗證（QR Code + 門牌綁定）
- FR-003: 個人資料管理
- FR-004: 商品發布（簡化版：4張照片、全新/二手、網址、時間區間）
- FR-005: 商品列表與動態
- FR-006: 商品詳情（含網址、使用時間、留言區）
- FR-007: 商品管理
- FR-008: 分類瀏覽
- FR-009: 關鍵字搜尋
- FR-010: 商品留言板（公開+隱私留言、一鍵議價、推播通知）
- FR-011: 留言通知與管理
- FR-012: 交易完成確認
- FR-013: 評價系統
- FR-014: 個人主頁
- FR-015: 檢舉機制
- FR-016: 封鎖功能
- FR-017: 交易紀錄
- FR-018: 社區認證徽章
- FR-019: 管理員後台系統（Web）
- FR-020: 彈性交易模式（管理室代收、面交地點、現金支付）

**建議下一步:**
執行 `workflow create-epics-and-stories` 來將這些需求轉換為可實作的Epic與Story。

---

## 參考資料

- BMAD工作流程文件
- Flutter官方文件
- Firebase文件
- iOS Human Interface Guidelines
- Material Design Guidelines

---

## 下一步行動

1. ✅ **PRD完成** - 產品需求已完整定義
2. ⏭️ **Epic & Story分解** - 執行 `workflow create-epics-and-stories`
3. ⏭️ **UX設計** - 執行 `workflow ux-design` 建立使用者流程與介面設計
4. ⏭️ **技術架構** - 執行 `workflow create-architecture` 定義技術決策

---

**這份PRD捕捉了「鄰里市集」的核心魔力** — 當鄰居之間能夠在信任圈內輕鬆交易，不只是物品流通，更是社區關係的建立。每一個功能都圍繞著「讓交易變得像跟鄰居借東西一樣自然」這個核心理念設計。

---

## 版本更新歷史

**Version 2.2（2025-11-13）- 需求完整性補充**
1. **新增補充需求章節（FR-021 至 FR-034）**
   - 錯誤處理和異常情況需求（FR-021, FR-022, FR-023）
   - 數據隱私和安全需求（FR-024, FR-025, FR-026）
   - 管理室後台詳細需求（FR-027, FR-028, FR-029, FR-030）
   - 使用者體驗細節需求（FR-031, FR-032, FR-033, FR-034）
2. **基於 Brainstorming Session 分析報告補充缺失需求**
3. **功能需求**: 20個 → 34個

**Version 2.1（2025-11-13）- 功能分層優化**
1. **新增FR-020: 彈性交易模式**
   - 管理室代收服務（6位數取貨碼、現金代收代付）
   - 社區公共區域面交（大廳、中庭、郵件室）
   - 門口/樓下面交（約定地點）
   - 管理員後台新增代收商品管理功能
2. **FR-010強化: 一鍵議價功能**
   - 💰 議價按鈕與滑桿介面
   - 自動計算折扣百分比
   - 自動產生議價留言
   - 賣家快速回覆（接受/拒絕/再議）
3. **現金支付機制明確化**
   - MVP階段僅支援現金交易
   - 管理室代收時由管理員代為收款與轉交
   - 線上支付移至Phase 2
4. **功能分層重新規劃**:
   - **Phase 2核心新功能**:
     - 批量上架功能（大掃除模式）
     - 社區公告整合（數位布告欄）
     - 以物易物功能（交換模式）
   - **Phase 3夢想功能**:
     - AI智能拍照輔助（自動去背、光線調整、構圖建議、品質評分）
5. **功能需求**: 19個 → 20個

**Version 2.0（2025-11-13）- 重大更新**
1. **後端技術變更**: Firebase → Supabase（開源、PostgreSQL、更強大的權限控制）
2. **註冊登入重新設計**:
   - 手機號碼驗證 → 第三方登入（Google/Apple/LINE）
   - 社區代碼驗證 → QR Code掃描 + 門牌綁定
3. **商品發布簡化**:
   - 固定4張照片（降低門檻）
   - 新增：商品網址連結（自動抓取標題）
   - 新增：使用時間區間選擇
   - 簡化：全新/二手兩種狀態
4. **留言板功能強化**:
   - 新增：隱私留言功能（僅賣家可見）
   - 新增：推播通知（MVP即包含）
   - 公開+隱私混合留言模式
5. **新增管理員後台**:
   - Web後台系統
   - QR Code產生器
   - 住戶驗證管理
   - 數據統計面板
6. **推播通知系統**:
   - 從Phase 2移至MVP
   - 支援留言通知、交易通知、評價提醒
7. **功能需求**: 18個 → 19個（新增FR-019管理員後台）

**Version 1.0（2025-11-13）- 初版**
- 初始PRD完成
- 定義MVP範圍與18個功能需求
- 確定Firebase後端架構

---

*本文件由產品團隊與AI協作共同完成，持續更新中。*

# 需求補充文件

**日期：** 2025-11-13  
**作者：** Business Analyst  
**目的：** 補充 Brainstorming Session 分析報告中識別的缺失需求

---

## 1. 錯誤處理和異常情況需求

### 1.1 交易失敗處理流程

**需求描述：**
當交易過程中發生異常情況時，系統需要提供明確的處理流程。

**具體需求：**

#### 交易取消流程
- **賣家取消交易：**
  - 賣家可在「已預訂」狀態下取消預訂
  - 系統通知買家「賣家已取消交易」
  - 商品狀態自動變回「上架中」
  - 記錄取消原因（選填）

- **買家取消交易：**
  - 買家可在「已預訂」狀態下取消預訂
  - 系統通知賣家「買家已取消交易」
  - 商品狀態自動變回「上架中」
  - 記錄取消原因（選填）

#### 管理室代收異常處理
- **商品未送達管理室：**
  - 買家超過 24 小時未收到「商品已送達」通知
  - 系統自動提醒賣家「請確認商品是否已送至管理室」
  - 賣家可選擇「重新送達」或「取消交易」

- **商品遺失或損壞：**
  - 管理員在後台可標記「商品異常」
  - 系統通知買賣雙方
  - 提供爭議處理流程（見 1.2）

- **買家未取貨：**
  - 商品送達管理室後 7 天未取貨
  - 系統自動通知買家「請盡快取貨」
  - 14 天後自動取消交易，商品退回賣家

#### 系統錯誤處理
- **網路連線中斷：**
  - 自動重試機制（最多 3 次）
  - 顯示友善錯誤訊息：「網路連線不穩，請稍後再試」
  - 離線模式下可瀏覽已載入內容

- **資料同步失敗：**
  - 顯示「資料同步中，請稍候」
  - 自動在背景重試同步
  - 提供「手動重新整理」按鈕

---

### 1.2 商品描述不符的爭議處理

**需求描述：**
當買家發現商品與描述不符時，需要提供明確的爭議處理機制。

**具體需求：**

#### 爭議申訴流程
1. **買家提出爭議：**
   - 在交易完成後 7 天內可提出爭議
   - 選擇爭議類型：
     - 商品描述不符
     - 商品損壞或缺失
     - 商品功能異常
     - 其他（需填寫說明）
   - 上傳證據照片（最多 5 張）
   - 填寫爭議說明（必填，50-500 字）

2. **系統通知賣家：**
   - 賣家收到「交易爭議通知」
   - 賣家可查看買家提出的爭議內容和證據
   - 賣家可選擇：
     - 接受爭議，同意退款或換貨
     - 提出反駁（需提供證據）
     - 請求平台仲裁

3. **平台仲裁機制：**
   - 當買賣雙方無法達成共識時，可請求平台仲裁
   - 平台管理員查看爭議內容和證據
   - 平台管理員做出裁決：
     - 支持買家（賣家需退款或換貨）
     - 支持賣家（交易維持原狀）
     - 部分支持（部分退款或換貨）
   - 裁決結果通知雙方
   - 裁決後 3 天內可提出上訴（僅限一次）

#### 爭議記錄
- 所有爭議記錄保存在 `disputes` 資料表
- 記錄包含：爭議類型、證據、處理結果、處理時間
- 爭議記錄影響賣家信用評分
- 多次爭議的賣家會被標記「高風險賣家」

---

### 1.3 支付糾紛處理機制

**需求描述：**
現金交易可能出現的支付糾紛需要明確的處理流程。

**具體需求：**

#### 現金支付確認機制
- **管理室代收現金：**
  - 管理員在後台確認「已收到現金」
  - 系統記錄收款時間和金額
  - 賣家領取現金時，管理員確認「已交付現金」
  - 所有現金交易都有記錄可查

- **大廳面交現金：**
  - 買賣雙方在 App 中確認「已完成現金交易」
  - 系統記錄交易完成時間
  - 建議：交易時拍照留存（選填）

#### 支付糾紛處理
- **金額不符：**
  - 買家可提出「支付金額不符」爭議
  - 系統記錄雙方聲稱的金額
  - 提供平台仲裁機制

- **未收到款項：**
  - 賣家可提出「未收到款項」爭議
  - 系統檢查交易記錄
  - 管理室代收：檢查管理員記錄
  - 大廳面交：檢查雙方確認記錄

---

### 1.4 系統故障時的備援方案

**需求描述：**
當系統發生故障時，需要確保基本功能仍可使用。

**具體需求：**

#### 離線模式支援
- **可離線使用的功能：**
  - 瀏覽已載入的商品列表
  - 查看已載入的商品詳情
  - 查看已載入的留言
  - 查看個人資料和交易記錄

- **離線模式限制：**
  - 無法發布新商品
  - 無法發表新留言
  - 無法完成交易確認
  - 顯示「離線模式」提示

#### 資料同步機制
- 當網路恢復時，自動同步離線期間的操作
- 顯示「正在同步資料」提示
- 同步失敗時，提供「手動同步」按鈕

#### 系統維護通知
- 系統維護前 24 小時通知使用者
- 維護期間顯示「系統維護中」頁面
- 維護完成後自動恢復服務

---

## 2. 數據隱私和安全需求

### 2.1 門牌號碼顯示規則

**需求描述：**
門牌號碼是敏感資訊，需要明確的顯示規則。

**具體需求：**

#### 顯示規則
- **對其他使用者：**
  - 僅顯示「棟別」和「樓層」（例：「A棟 3樓」）
  - 不顯示完整門牌號碼（例：不顯示「301號」）
  - 目的：保護隱私，同時提供足夠的位置資訊

- **對自己：**
  - 顯示完整門牌號碼（例：「A棟 3樓 301號」）
  - 可在個人設定中選擇是否顯示完整地址

- **對管理員：**
  - 管理員可查看完整門牌號碼（用於驗證和管理）

#### 隱私設定
- 使用者可在設定中選擇：
  - 「顯示完整地址」（預設：關閉）
  - 「僅顯示棟別和樓層」（預設：開啟）
  - 「完全隱藏位置資訊」（不建議，影響信任建立）

---

### 2.2 個人資料保護措施

**需求描述：**
確保使用者個人資料的安全和隱私。

**具體需求：**

#### 資料收集最小化
- 僅收集必要的個人資料：
  - 暱稱（必填）
  - Email（用於通知，可選）
  - 頭像（可選）
  - 社區資訊（必填，用於驗證）

- 不收集的資料：
  - 真實姓名（除非使用者自願提供）
  - 手機號碼（除非使用者自願提供）
  - 身份證字號
  - 銀行帳號

#### 資料儲存安全
- 所有敏感資料加密儲存
- 使用 Supabase Row Level Security (RLS) 確保資料存取權限
- 定期安全審計

#### 資料使用限制
- 個人資料僅用於平台功能
- 不向第三方分享個人資料
- 不進行資料分析或廣告投放

---

### 2.3 交易數據加密標準

**需求描述：**
確保交易數據在傳輸和儲存過程中的安全。

**具體需求：**

#### 傳輸加密
- 所有 API 請求使用 HTTPS
- 使用 TLS 1.2 或更高版本
- 證書固定（Certificate Pinning）防止中間人攻擊

#### 儲存加密
- 敏感資料（如交易金額、個人資訊）加密儲存
- 使用 Supabase 內建的加密功能
- 加密金鑰安全管理

#### 資料備份加密
- 所有備份資料加密儲存
- 備份存取需要身份驗證

---

### 2.4 GDPR/個資法合規性

**需求描述：**
確保平台符合台灣個人資料保護法要求。

**具體需求：**

#### 使用者權利
- **資料查詢權：**
  - 使用者可查看自己的所有個人資料
  - 提供「下載我的資料」功能（JSON 格式）

- **資料更正權：**
  - 使用者可隨時更正自己的個人資料
  - 提供「編輯個人資料」功能

- **資料刪除權：**
  - 使用者可申請刪除帳號和所有個人資料
  - 提供「刪除帳號」功能
  - 刪除前需確認（防止誤刪）
  - 刪除後 30 天內可恢復（之後永久刪除）

- **資料可攜權：**
  - 使用者可下載自己的資料（JSON 格式）
  - 包含：個人資料、商品資料、交易記錄、評價記錄

#### 隱私政策
- 提供完整的隱私政策文件
- 首次使用時顯示隱私政策
- 使用者需同意隱私政策才能使用平台
- 隱私政策更新時通知使用者

#### 資料保留政策
- 交易記錄保留 2 年
- 評價記錄保留 2 年
- 商品資料保留 1 年（下架後）
- 個人資料保留至帳號刪除

---

## 3. 管理室後台詳細需求

### 3.1 管理員權限管理

**需求描述：**
不同層級的管理員需要不同的權限。

**具體需求：**

#### 權限層級
1. **超級管理員（Super Admin）：**
   - 建立和管理所有社區
   - 建立和管理所有管理員帳號
   - 查看所有社區的數據
   - 系統設定和配置
   - 爭議仲裁

2. **社區管理員（Community Admin）：**
   - 管理指定社區的住戶驗證
   - 產生 QR Code
   - 查看該社區的數據
   - 管理該社區的代收商品
   - 查看該社區的交易記錄

3. **管理室操作員（Operator）：**
   - 僅能操作代收商品管理
   - 登記「已收到商品」
   - 登記「已取貨」
   - 現金管理
   - 無法查看住戶個人資料

#### 權限控制
- 使用 Supabase Row Level Security (RLS) 實現權限控制
- 每個操作都記錄操作者和時間
- 敏感操作需要二次確認

---

### 3.2 操作日誌記錄

**需求描述：**
記錄所有管理員的操作，用於審計和追蹤。

**具體需求：**

#### 記錄內容
- 操作時間
- 操作者（管理員帳號）
- 操作類型（產生 QR Code、登記代收、確認取貨等）
- 操作對象（住戶、商品、交易）
- IP 位址
- 操作結果（成功/失敗）

#### 日誌查詢
- 管理員可查看自己的操作記錄
- 超級管理員可查看所有操作記錄
- 支援依時間、操作類型、操作者篩選
- 日誌保留 90 天

---

### 3.3 批量操作功能

**需求描述：**
管理員需要批量處理功能以提高效率。

**具體需求：**

#### 批量操作類型
1. **批量產生 QR Code：**
   - 選擇多個門牌號碼
   - 一次產生多個 QR Code
   - 可下載或列印所有 QR Code

2. **批量匯入門牌資料：**
   - 上傳 CSV 檔案
   - 自動解析並建立門牌資料
   - 支援錯誤檢查和修正

3. **批量標記驗證狀態：**
   - 選擇多個住戶
   - 批量標記為「已驗證」或「未驗證」

---

### 3.4 異常交易警示機制

**需求描述：**
當發現異常交易時，系統應自動警示管理員。

**具體需求：**

#### 異常交易類型
1. **短時間大量交易：**
   - 同一使用者 24 小時內完成 10 筆以上交易
   - 警示管理員檢查是否為異常行為

2. **高金額交易：**
   - 單筆交易金額超過 NT$ 10,000
   - 警示管理員注意

3. **爭議交易：**
   - 同一賣家多次被提出爭議
   - 警示管理員檢查賣家行為

4. **異常 IP：**
   - 同一帳號從多個不同 IP 登入
   - 警示管理員檢查是否為帳號被盜用

#### 警示機制
- 系統自動檢測異常交易
- 發送警示通知給管理員
- 管理員可查看異常交易詳情
- 管理員可標記為「已處理」或「需進一步調查」

---

## 4. 使用者體驗細節需求

### 4.1 首次使用引導流程

**需求描述：**
新使用者需要引導以了解平台功能。

**具體需求：**

#### 引導流程
1. **歡迎頁面：**
   - 介紹平台核心價值
   - 顯示「開始使用」按鈕

2. **登入引導：**
   - 說明第三方登入方式
   - 顯示「選擇登入方式」按鈕

3. **社區驗證引導：**
   - 說明社區驗證的重要性
   - 顯示「前往管理室驗證」按鈕
   - 提供「稍後驗證」選項（功能受限）

4. **功能介紹：**
   - 首次發布商品時，顯示「如何發布商品」引導
   - 首次留言時，顯示「如何留言」引導
   - 首次交易時，顯示「如何完成交易」引導

#### 引導設定
- 使用者可選擇「跳過引導」
- 引導可隨時在設定中重新開啟
- 引導使用互動式設計（點擊、滑動）

---

### 4.2 錯誤訊息設計

**需求描述：**
錯誤訊息應該友善、清晰，幫助使用者理解問題。

**具體需求：**

#### 錯誤訊息原則
- **友善的語言：** 避免技術術語，使用使用者能理解的語言
- **明確的說明：** 清楚說明問題和解決方法
- **視覺提示：** 使用圖示和顏色區分不同類型的錯誤

#### 錯誤訊息類型
1. **網路錯誤：**
   - 訊息：「網路連線不穩，請稍後再試」
   - 圖示：WiFi 圖示
   - 動作：提供「重試」按鈕

2. **驗證錯誤：**
   - 訊息：「QR Code 已過期，請重新掃描」
   - 圖示：時鐘圖示
   - 動作：提供「重新掃描」按鈕

3. **權限錯誤：**
   - 訊息：「此功能需要完成社區驗證」
   - 圖示：鎖頭圖示
   - 動作：提供「前往驗證」按鈕

4. **資料錯誤：**
   - 訊息：「請檢查輸入的資料是否正確」
   - 圖示：警告圖示
   - 動作：標示錯誤欄位

---

### 4.3 載入狀態處理

**需求描述：**
載入狀態應該提供良好的使用者體驗。

**具體需求：**

#### 載入狀態類型
1. **頁面載入：**
   - 顯示載入動畫（Skeleton Screen）
   - 顯示「載入中...」文字
   - 超過 5 秒顯示「載入時間較長，請稍候」

2. **資料上傳：**
   - 顯示上傳進度條
   - 顯示「上傳中... X%」文字
   - 上傳失敗時顯示錯誤訊息和「重試」按鈕

3. **操作處理：**
   - 顯示處理動畫
   - 顯示「處理中...」文字
   - 處理完成後顯示成功訊息

#### 載入優化
- 使用漸進式載入（先顯示基本內容，再載入詳細內容）
- 使用快取減少載入時間
- 預載入下一頁內容

---

### 4.4 離線功能支援

**需求描述：**
當網路不穩定時，提供基本的離線功能。

**具體需求：**

#### 離線功能範圍
- **可離線使用：**
  - 瀏覽已載入的商品列表
  - 查看已載入的商品詳情
  - 查看已載入的留言
  - 查看個人資料和交易記錄
  - 編輯草稿（未發布的商品）

- **不可離線使用：**
  - 發布新商品
  - 發表新留言
  - 完成交易確認
  - 搜尋新商品

#### 離線模式提示
- 顯示「離線模式」提示
- 顯示「正在同步資料」狀態
- 網路恢復時自動同步

---

## 5. 非功能性需求補充

### 5.1 可靠性需求

#### 系統可用性目標
- **目標：** 99.5% 可用性（每月停機時間 < 3.6 小時）
- **監控：** 使用 Supabase 內建監控工具
- **告警：** 當可用性低於 99% 時自動告警

#### 數據備份和恢復策略
- **備份頻率：** 每日自動備份
- **備份保留：** 30 天
- **備份測試：** 每月測試一次備份恢復
- **災難恢復時間目標（RTO）：** 4 小時
- **災難恢復點目標（RPO）：** 24 小時

#### 災難恢復計劃
- 定義災難恢復流程
- 指定災難恢復負責人
- 定期演練災難恢復流程

---

### 5.2 安全性需求補充

#### QR Code 安全性強化
- **時效性：** QR Code 有效期 5 分鐘
- **一次性 Token：** 每個 QR Code 包含一次性 Token，掃描後立即失效
- **防重放攻擊：** 使用時間戳記和隨機數防止重放攻擊
- **異常檢測：** 檢測短時間內多次掃描同一 QR Code 的異常行為

#### API 安全標準
- **認證：** 所有 API 請求需要 JWT Token
- **授權：** 使用 Supabase Row Level Security (RLS) 實現資料層級授權
- **速率限制：** API 請求速率限制（防止濫用）
- **輸入驗證：** 所有輸入資料都進行驗證和清理

#### 資料傳輸加密
- **HTTPS：** 所有資料傳輸使用 HTTPS
- **TLS 版本：** 使用 TLS 1.2 或更高版本
- **證書固定：** 使用證書固定防止中間人攻擊

---

### 5.3 效能需求補充

#### 響應時間目標
- **頁面載入：** < 2 秒（首次啟動）
- **頁面切換：** < 300ms
- **API 回應：** < 500ms（95% 請求）
- **圖片載入：** < 1 秒（漸進式載入）

#### 並發使用者數
- **MVP 階段：** 支援同時 1,000 個活躍使用者
- **成長階段：** 支援同時 10,000 個活躍使用者
- **擴展計劃：** 使用 Supabase 自動擴展功能

#### 資源使用優化
- **App 記憶體：** < 200MB
- **電池消耗：** 背景不執行非必要任務
- **流量優化：** 圖片壓縮、快取機制、資料分頁

---

## 6. 驗收標準

### 6.1 錯誤處理驗收標準
- [ ] 所有錯誤情況都有對應的處理流程
- [ ] 錯誤訊息友善、清晰
- [ ] 使用者可以從錯誤中恢復
- [ ] 系統錯誤不會導致資料遺失

### 6.2 安全性驗收標準
- [ ] 所有敏感資料加密儲存
- [ ] 所有資料傳輸使用 HTTPS
- [ ] QR Code 安全性機制正常運作
- [ ] 權限控制正常運作

### 6.3 使用者體驗驗收標準
- [ ] 首次使用引導流程完整
- [ ] 錯誤訊息友善、清晰
- [ ] 載入狀態提供良好體驗
- [ ] 離線模式基本功能可用

---

## 7. 優先級

### P0（必須完成 - MVP）
- 錯誤處理和異常情況需求（基本流程）
- QR Code 安全性機制
- 資料隱私和安全需求（基本措施）
- 首次使用引導流程

### P1（高優先級 - MVP 後）
- 爭議處理機制
- 管理室後台詳細需求
- 錯誤訊息設計優化
- 離線功能支援

### P2（中優先級 - 未來版本）
- 批量操作功能
- 異常交易警示機制
- 災難恢復計劃
- 效能優化

---

**文件完成日期：** 2025-11-13  
**下次審查：** PRD 更新後


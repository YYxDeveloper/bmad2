# 鄰里市集 - 結帳流程 UX 設計

**設計目標：** Checkout Process（交易完成流程）
**輸出格式：** Markdown Wireframe Description
**日期：** 2025-11-13
**設計師：** UX Designer

---

## 1. 使用者流程總覽

### 1.1 流程圖

```
[商品詳情頁] 
    ↓
[買家留言表達購買意願]
    ↓
[賣家選擇「標記為已售出」]
    ↓
[選擇成交買家] ──→ [選擇交易模式]
    ↓                    ↓
[管理室代收流程]    [大廳面交流程]    [門口面交流程]
    ↓                    ↓                    ↓
[賣家送達管理室]    [約定面交時間地點]    [約定面交時間地點]
    ↓                    ↓                    ↓
[買家取貨付款]      [現場面交付款]      [現場面交付款]
    ↓                    ↓                    ↓
[交易完成確認] ──────────┴────────────────────┘
    ↓
[雙方評價流程]
    ↓
[交易紀錄保存]
```

### 1.2 關鍵決策點

1. **賣家選擇成交買家** - 從留言者中選擇或手動輸入
2. **選擇交易模式** - 管理室代收 vs 大廳面交 vs 門口面交
3. **買家確認交易** - 收到通知後確認是否完成交易
4. **評價流程** - 雙方互相評價

---

## 2. 使用者流程詳細設計

### 2.1 流程 1：賣家標記已售出

**入口：** 商品管理頁面 → 我的商品 → 選擇商品 → 「標記為已售出」

**使用者目標：** 快速標記商品已售出並選擇成交買家

**流程步驟：**

1. **確認對話框**
   - 標題：「標記為已售出」
   - 內容：「確定要將此商品標記為已售出嗎？標記後將無法再接收新留言。」
   - 按鈕：「取消」「確認」

2. **選擇成交買家**
   - 顯示該商品的所有留言者列表
   - 每個留言者顯示：頭像、暱稱、認證徽章、最後留言時間、留言內容摘要
   - 選中狀態：高亮顯示
   - 選項：「從留言者中選擇」或「私下交易（手動輸入買家）」

3. **手動輸入買家（可選）**
   - 輸入框：買家暱稱或社區代碼
   - 搜尋結果：顯示匹配的使用者列表
   - 選擇後確認

4. **選擇交易模式**
   - 三個選項卡片：
     - 🏢 管理室代收
     - 🏛️ 大廳面交
     - 🚪 門口面交
   - 每個選項顯示簡短說明和圖示

5. **確認提交**
   - 顯示摘要：買家、交易模式
   - 按鈕：「確認」「返回修改」

---

### 2.2 流程 2：管理室代收流程

#### 2.2.1 賣家端流程

**入口：** 選擇「管理室代收」後

**步驟 1：產生代收編號**
- 顯示代收編號（6位數字，大字體，可複製）
- 顯示 QR Code（供管理員掃描）
- 提示：「請將此編號告知管理員」
- 按鈕：「我已送達管理室」「稍後再送」

**步驟 2：送達管理室**
- 賣家將商品送至管理室
- 告知管理員代收編號
- 管理員在後台登記「已收到商品」

**步驟 3：等待買家取貨**
- 顯示狀態：「商品已送達管理室，等待買家取貨」
- 顯示買家資訊：暱稱、認證徽章
- 顯示金額：NT$ XXX
- 提示：「買家取貨後，您將收到通知，可前往管理室領取現金」

**步驟 4：交易完成**
- 收到通知：「買家已取貨，請前往管理室領取現金」
- 顯示取貨時間
- 按鈕：「我已領取現金」「稍後提醒我」

---

#### 2.2.2 買家端流程

**入口：** 收到推播通知「商品已送達管理室」

**步驟 1：查看通知**
- 通知內容：「【商品名稱】已送達管理室，請攜帶代收編號前往取貨」
- 點擊通知跳轉到「我的交易」頁面

**步驟 2：查看代收資訊**
- 顯示商品資訊：圖片、名稱、價格
- 顯示代收編號（6位數字，大字體，可複製）
- 顯示管理室位置提示
- 顯示賣家資訊：暱稱、認證徽章
- 按鈕：「我已取貨」「稍後提醒我」

**步驟 3：前往管理室取貨**
- 買家前往管理室
- 告知管理員代收編號
- 管理員核對編號，交付商品
- 買家現場驗貨
- 買家現場付款（現金交給管理員）

**步驟 4：確認取貨**
- 在 App 中點擊「我已取貨」
- 確認對話框：「您已收到商品並完成付款了嗎？」
- 選項：「是，已完成」「否，有問題」
- 若選擇「有問題」，進入爭議處理流程

**步驟 5：交易完成**
- 顯示「交易完成」確認頁面
- 提示：「感謝您的購買！請為賣家留下評價」
- 按鈕：「立即評價」「稍後評價」

---

### 2.3 流程 3：大廳面交流程

#### 2.3.1 選擇面交地點

**入口：** 選擇「大廳面交」後

**步驟 1：選擇面交地點**
- 顯示地點選項卡片：
  - 🏛️ 社區大廳（推薦，有監視器）
  - 🌳 社區中庭（推薦，白天）
  - 📦 郵件室/包裹室
  - ➕ 其他地點（手動輸入）
- 每個地點顯示安全提示圖示

**步驟 2：約定時間**
- 日期選擇器：選擇面交日期
- 時間選擇器：選擇面交時間（建議白天時段）
- 顯示建議時間：「建議選擇白天時段（09:00-18:00）」

**步驟 3：確認資訊**
- 顯示摘要：
  - 面交地點：XX社區大廳
  - 約定時間：2025-11-15 14:00
  - 買家：XXX（顯示頭像、暱稱）
  - 金額：NT$ XXX
- 安全提示：「請在公共區域完成交易，注意安全」
- 按鈕：「確認」「返回修改」

**步驟 4：發送通知**
- 系統自動發送通知給買家
- 通知內容：「賣家已約定大廳面交，時間：2025-11-15 14:00，地點：XX社區大廳」

---

#### 2.3.2 面交當天流程

**賣家端：**
1. 收到提醒通知（面交前1小時）
2. 前往約定地點
3. 等待買家
4. 完成面交後，在 App 中點擊「已完成面交」

**買家端：**
1. 收到提醒通知（面交前1小時）
2. 前往約定地點
3. 驗貨
4. 現場付款（現金）
5. 在 App 中點擊「已完成面交」

**雙方確認：**
- 賣家點擊「已完成面交」後，買家收到確認請求
- 買家確認後，交易完成
- 若買家未確認，7天後自動確認

---

### 2.4 流程 4：門口面交流程

**流程與大廳面交類似，差異：**

1. **地點選擇**
   - 社區大門
   - 特定樓層樓梯間
   - 手動輸入地點

2. **安全提示更強**
   - 「建議選擇白天時段」
   - 「建議在公共區域完成交易」
   - 「避免單獨前往陌生地點」

---

### 2.5 流程 5：交易完成確認

**入口：** 完成取貨/面交後

**步驟 1：買家確認**
- 收到通知：「您是否完成了【商品名稱】的交易？」
- 確認頁面：
  - 商品資訊
  - 交易對象
  - 交易金額
  - 確認選項：「是，已完成」「否，有問題」

**步驟 2：賣家確認（若為面交）**
- 賣家點擊「已完成面交」後，買家收到確認請求
- 買家確認後，雙方都收到「交易完成」通知

**步驟 3：觸發評價流程**
- 顯示評價提示：「請為交易對象留下評價」
- 按鈕：「立即評價」「稍後評價」
- 若選擇「稍後評價」，7天內可補評價

---

## 3. Wireframe 描述

### 3.1 頁面 1：標記已售出 - 選擇買家

**頁面標題：** 「標記為已售出」

**佈局：**
```
┌─────────────────────────────────┐
│  ← 返回    標記為已售出          │
├─────────────────────────────────┤
│                                  │
│  請選擇成交買家：                │
│                                  │
│  ┌───────────────────────────┐  │
│  │  👤 王小明  ✓ 已認證      │  │
│  │  最後留言：2小時前         │  │
│  │  "請問可以議價嗎？"        │  │
│  └───────────────────────────┘  │
│                                  │
│  ┌───────────────────────────┐  │
│  │  👤 李美麗  ✓ 已認證      │  │
│  │  最後留言：5小時前         │  │
│  │  "我想買，可以面交嗎？"    │  │
│  └───────────────────────────┘  │
│                                  │
│  ┌───────────────────────────┐  │
│  │  ➕ 私下交易（手動輸入）   │  │
│  └───────────────────────────┘  │
│                                  │
│           [下一步]                │
└─────────────────────────────────┘
```

**互動說明：**
- 點擊留言者卡片：選中該買家（顯示勾選標記）
- 點擊「私下交易」：開啟搜尋輸入框
- 點擊「下一步」：進入交易模式選擇

---

### 3.2 頁面 2：選擇交易模式

**頁面標題：** 「選擇交易方式」

**佈局：**
```
┌─────────────────────────────────┐
│  ← 返回    選擇交易方式          │
├─────────────────────────────────┤
│                                  │
│  成交買家：王小明  ✓ 已認證     │
│                                  │
│  請選擇交易方式：                │
│                                  │
│  ┌───────────────────────────┐  │
│  │  🏢 管理室代收            │  │
│  │  賣家送至管理室，買家取貨  │  │
│  │  最便利，無需約時間        │  │
│  └───────────────────────────┘  │
│                                  │
│  ┌───────────────────────────┐  │
│  │  🏛️ 大廳面交              │  │
│  │  社區公共區域面交          │  │
│  │  安全、公開、有監視器      │  │
│  └───────────────────────────┘  │
│                                  │
│  ┌───────────────────────────┐  │
│  │  🚪 門口面交               │  │
│  │  約定特定地點面交          │  │
│  │  彈性高，需雙方協調        │  │
│  └───────────────────────────┘  │
│                                  │
│           [確認]                  │
└─────────────────────────────────┘
```

**互動說明：**
- 點擊交易模式卡片：選中該模式（顯示邊框高亮）
- 點擊「確認」：根據選擇的模式進入對應流程

---

### 3.3 頁面 3：管理室代收 - 代收編號

**頁面標題：** 「管理室代收」

**佈局：**
```
┌─────────────────────────────────┐
│  ← 返回    管理室代收            │
├─────────────────────────────────┤
│                                  │
│  商品：嬰兒推車                  │
│  買家：王小明                    │
│  金額：NT$ 1,500                 │
│                                  │
│  ┌───────────────────────────┐  │
│  │                            │  │
│  │      代收編號              │  │
│  │                            │  │
│  │       123456               │  │
│  │                            │  │
│  │   [複製編號]               │  │
│  │                            │  │
│  │   [QR Code 圖示]           │  │
│  │                            │  │
│  └───────────────────────────┘  │
│                                  │
│  📋 請將此編號告知管理員         │
│                                  │
│  ⚠️ 編號有效期限：5分鐘          │
│                                  │
│  ┌───────────────────────────┐  │
│  │  ✓ 我已送達管理室          │  │
│  └───────────────────────────┘  │
│                                  │
│  [稍後再送]                      │
└─────────────────────────────────┘
```

**互動說明：**
- 點擊「複製編號」：複製到剪貼簿，顯示「已複製」
- 點擊 QR Code：全螢幕顯示 QR Code，供管理員掃描
- 點擊「我已送達管理室」：更新狀態為「等待買家取貨」

---

### 3.4 頁面 4：管理室代收 - 等待取貨

**頁面標題：** 「等待買家取貨」

**佈局：**
```
┌─────────────────────────────────┐
│  ← 返回    等待買家取貨          │
├─────────────────────────────────┤
│                                  │
│  ┌───────────────────────────┐  │
│  │  📦 商品已送達管理室       │  │
│  │                           │  │
│  │  商品：嬰兒推車            │  │
│  │  買家：王小明  ✓ 已認證   │  │
│  │  金額：NT$ 1,500          │  │
│  │                           │  │
│  │  送達時間：14:30          │  │
│  └───────────────────────────┘  │
│                                  │
│  ⏳ 等待買家取貨...              │
│                                  │
│  💡 買家取貨後，您將收到通知，   │
│     可前往管理室領取現金         │
│                                  │
│  [查看代收編號]                  │
└─────────────────────────────────┘
```

**互動說明：**
- 頁面自動更新狀態（使用 Supabase Realtime）
- 買家取貨後，自動跳轉到「交易完成」頁面

---

### 3.5 頁面 5：買家取貨通知

**頁面標題：** 「商品已送達管理室」

**佈局：**
```
┌─────────────────────────────────┐
│  ← 返回    商品已送達            │
├─────────────────────────────────┤
│                                  │
│  ┌───────────────────────────┐  │
│  │  📦 商品圖片              │  │
│  │  嬰兒推車                 │  │
│  │  NT$ 1,500                │  │
│  └───────────────────────────┘  │
│                                  │
│  賣家：李美麗  ✓ 已認證         │
│                                  │
│  ┌───────────────────────────┐  │
│  │                            │  │
│  │      代收編號              │  │
│  │                            │  │
│  │       123456               │  │
│  │                            │  │
│  │   [複製編號]               │  │
│  │                            │  │
│  └───────────────────────────┘  │
│                                  │
│  📍 請前往管理室取貨             │
│                                  │
│  💰 請準備現金：NT$ 1,500        │
│                                  │
│  ┌───────────────────────────┐  │
│  │  ✓ 我已取貨                │  │
│  └───────────────────────────┘  │
│                                  │
│  [稍後提醒我]                    │
└─────────────────────────────────┘
```

**互動說明：**
- 點擊「複製編號」：複製代收編號
- 點擊「我已取貨」：開啟確認對話框
- 確認後進入「交易完成」頁面

---

### 3.6 頁面 6：大廳面交 - 選擇地點

**頁面標題：** 「選擇面交地點」

**佈局：**
```
┌─────────────────────────────────┐
│  ← 返回    選擇面交地點          │
├─────────────────────────────────┤
│                                  │
│  成交買家：王小明  ✓ 已認證     │
│                                  │
│  請選擇面交地點：                │
│                                  │
│  ┌───────────────────────────┐  │
│  │  🏛️ 社區大廳              │  │
│  │  ✓ 推薦：有監視器、安全   │  │
│  └───────────────────────────┘  │
│                                  │
│  ┌───────────────────────────┐  │
│  │  🌳 社區中庭               │  │
│  │  ✓ 推薦：白天時段         │  │
│  └───────────────────────────┘  │
│                                  │
│  ┌───────────────────────────┐  │
│  │  📦 郵件室/包裹室          │  │
│  └───────────────────────────┘  │
│                                  │
│  ┌───────────────────────────┐  │
│  │  ➕ 其他地點                │  │
│  └───────────────────────────┘  │
│                                  │
│           [下一步]                │
└─────────────────────────────────┘
```

**互動說明：**
- 點擊地點卡片：選中該地點
- 點擊「其他地點」：開啟文字輸入框
- 點擊「下一步」：進入時間選擇

---

### 3.7 頁面 7：大廳面交 - 約定時間

**頁面標題：** 「約定面交時間」

**佈局：**
```
┌─────────────────────────────────┐
│  ← 返回    約定面交時間          │
├─────────────────────────────────┤
│                                  │
│  地點：社區大廳                  │
│                                  │
│  選擇日期：                      │
│  ┌───────────────────────────┐  │
│  │  2025年11月                │  │
│  │  [日期選擇器]              │  │
│  └───────────────────────────┘  │
│                                  │
│  選擇時間：                      │
│  ┌───────────────────────────┐  │
│  │  [時間選擇器]              │  │
│  │  建議：09:00 - 18:00       │  │
│  └───────────────────────────┘  │
│                                  │
│  ⚠️ 安全提示：                   │
│  • 建議選擇白天時段              │
│  • 在公共區域完成交易            │
│  • 注意個人安全                  │
│                                  │
│  ┌───────────────────────────┐  │
│  │  確認約定                  │  │
│  └───────────────────────────┘  │
└─────────────────────────────────┘
```

**互動說明：**
- 日期選擇器：顯示月曆，可選擇日期
- 時間選擇器：滾輪選擇時間
- 點擊「確認約定」：發送通知給買家

---

### 3.8 頁面 8：交易完成確認

**頁面標題：** 「交易完成」

**佈局：**
```
┌─────────────────────────────────┐
│                                  │
│         ✓ 交易完成               │
│                                  │
│  ┌───────────────────────────┐  │
│  │  📦 商品圖片              │  │
│  │  嬰兒推車                 │  │
│  │  NT$ 1,500                │  │
│  └───────────────────────────┘  │
│                                  │
│  交易對象：王小明  ✓ 已認證      │
│  交易時間：2025-11-13 14:30     │
│  交易方式：管理室代收            │
│                                  │
│  ┌───────────────────────────┐  │
│  │  感謝您的交易！            │  │
│  │  請為對方留下評價          │  │
│  └───────────────────────────┘  │
│                                  │
│  ┌───────────────────────────┐  │
│  │  立即評價                  │  │
│  └───────────────────────────┘  │
│                                  │
│  [稍後評價]                      │
└─────────────────────────────────┘
```

**互動說明：**
- 點擊「立即評價」：進入評價頁面
- 點擊「稍後評價」：返回首頁，7天內可補評價

---

## 4. 互動設計細節

### 4.1 狀態反饋

**載入狀態：**
- 提交交易模式選擇時：顯示「處理中...」載入動畫
- 等待買家取貨時：顯示「等待中...」動畫

**成功狀態：**
- 代收編號產生成功：顯示「✓ 編號已產生」
- 交易完成：顯示「✓ 交易完成」動畫

**錯誤狀態：**
- 網路錯誤：顯示「網路連線不穩，請稍後再試」+「重試」按鈕
- 驗證錯誤：顯示「請檢查輸入的資料」+ 標示錯誤欄位

---

### 4.2 通知設計

**推播通知內容：**

1. **商品已送達管理室（買家）**
   - 標題：「商品已送達管理室」
   - 內容：「【嬰兒推車】已送達管理室，請攜帶代收編號前往取貨」
   - 動作：點擊跳轉到「我的交易」頁面

2. **買家已取貨（賣家）**
   - 標題：「買家已取貨」
   - 內容：「【嬰兒推車】買家已取貨，請前往管理室領取現金」
   - 動作：點擊跳轉到「我的交易」頁面

3. **面交提醒（雙方）**
   - 標題：「面交提醒」
   - 內容：「【嬰兒推車】面交時間：今天 14:00，地點：社區大廳」
   - 動作：點擊跳轉到「我的交易」頁面

---

### 4.3 錯誤處理

**錯誤情境與處理：**

1. **代收編號過期**
   - 顯示：「代收編號已過期，請重新產生」
   - 動作：提供「重新產生編號」按鈕

2. **買家未取貨（7天後）**
   - 顯示：「買家超過7天未取貨，交易已自動取消」
   - 動作：商品狀態恢復為「上架中」，賣家可重新上架

3. **交易確認失敗**
   - 顯示：「交易確認失敗，請稍後再試」
   - 動作：提供「重試」按鈕，自動重試最多3次

---

## 5. 無障礙設計考量

### 5.1 視覺設計

- **字體大小：** 最小 14px，重要資訊 16px+
- **對比度：** 符合 WCAG AA 標準（4.5:1）
- **色彩：** 不只依賴顏色傳達資訊，使用圖示和文字

### 5.2 互動設計

- **觸控目標：** 最小 44x44px
- **手勢支援：** 支援左右滑動切換交易模式卡片
- **鍵盤導航：** 支援 Tab 鍵導航（Web 後台）

### 5.3 文字設計

- **語言：** 繁體中文
- **語氣：** 友善、親切、在地化
- **提示文字：** 清晰、具體、可操作

---

## 6. 技術實作建議

### 6.1 狀態管理

- 使用 Riverpod 管理交易狀態
- 使用 Supabase Realtime 即時更新交易狀態
- 本地快取交易資料（離線支援）

### 6.2 資料流程

```
賣家選擇交易模式
    ↓
產生代收編號（後端）
    ↓
更新交易狀態（Supabase）
    ↓
觸發推播通知（Edge Function）
    ↓
買家收到通知
    ↓
買家確認取貨
    ↓
更新交易狀態
    ↓
觸發評價流程
```

### 6.3 效能優化

- 圖片延遲載入
- 列表虛擬滾動
- 狀態更新批次處理
- 推播通知節流（避免重複通知）

---

## 7. 測試場景

### 7.1 正常流程測試

1. 賣家標記已售出 → 選擇買家 → 選擇管理室代收 → 產生編號 → 送達管理室 → 買家取貨 → 交易完成
2. 賣家標記已售出 → 選擇買家 → 選擇大廳面交 → 約定時間地點 → 雙方面交 → 交易完成

### 7.2 異常流程測試

1. 網路中斷：交易狀態更新失敗 → 自動重試
2. 買家未取貨：7天後自動取消交易
3. 代收編號過期：提示重新產生

### 7.3 邊界情況測試

1. 多個買家同時留言：正確顯示所有留言者
2. 交易金額為 0（免費贈送）：正確處理
3. 買家取消交易：正確恢復商品狀態

---

## 8. 後續優化建議

### 8.1 Phase 2 優化

- **批量交易：** 一次處理多個商品的交易
- **交易歷史：** 查看過去的交易記錄
- **交易統計：** 顯示交易成功率、平均交易時間

### 8.2 Phase 3 優化

- **智能推薦：** 根據歷史交易推薦最佳交易模式
- **自動提醒：** 智能提醒賣家送達、買家取貨
- **交易分析：** 分析交易模式偏好，優化流程

---

## 附錄：相關文件

- [PRD.md](../PRD.md) - 產品需求文件
- [epics.md](./epics.md) - Epic 分解文件
- Epic 5: 交易流程 - Story 5.1 至 Story 5.7

---

_本文件為結帳流程的 UX 設計規範，供開發團隊實作參考。_

